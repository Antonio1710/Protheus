#INCLUDE "PROTHEUS.CH"
#INCLUDE "TOPCONN.CH"

/*/{Protheus.doc} User Function ADFIS043R
	Relatório de Conferência de escrituração Fiscal
	@type  Function
	@author Abel Babini
	@since 20/07/2020
	@history Chamado TI       - Abel Babini - 21/07/2020 - Gera relatório de conferência de escritura fiscal
	@history Chamado 25       - Everson     - 30/09/2020 - Tratamento da série da nota fiscal.
	@history Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
	/*/
User Function ADFIS043R() // U_ADFIS043R()
	Local aArea		:= GetArea()
	Local aPergs	:= {}
	Local aRet    	:= {}

	aAdd( aPergs ,{1,"Data De "     ,Ctod(space(8)),"" ,'.T.',,'.T.',80,.T.})
	aAdd( aPergs ,{1,"Data Até"     ,Ctod(space(8)),"" ,'.T.',,'.T.',80,.T.})
	aAdd( aPergs ,{6,"Local de Gravação",Space(50),"","","",50,.T.,"Todos os arquivos (*.*) |*.*","C:\TEMP\",GETF_RETDIRECTORY + GETF_LOCALHARD + GETF_NETWORKDRIVE})

	//Executa as perguntas ao usuário e só executa o relatório caso o usuário confirme a tela de parâmetros;
	If ParamBox(aPergs ,"Parâmetros ",aRet,,,,,,,,.T.,.T.)
		MsAguarde({|| RCONFESCR(aRet[1], aRet[2], aRet[3])}, "Aguarde...", "Carregando dados - Conferência escrituração fiscal, aguarde..")
	
	Endif

	RestArea(aArea)

	//
	U_ADINF009P(SUBSTRING(ALLTRIM(PROCNAME()),3,LEN(ALLTRIM(PROCNAME()))) + '.PRW',SUBSTRING(ALLTRIM(PROCNAME()),3,LEN(ALLTRIM(PROCNAME()))),'Rel de Conferência de escrituração Fiscal')


Return

/*/{Protheus.doc} Static Function RCONFESCR
  Gera Relatório
  @type  Static Function
  @author Abel Babini
  @since 21/07/2020
  /*/
Static Function RCONFESCR(_mvpr01, _mvpr02, CRELPATH)
  //Local aSM0Data := FWSM0Util():GetSM0Data()
	// Local cMVEFex := GETMV("MV_#FIS43R",,"0101,0102,0103,0104,0105,0106,0107,0108,0109,0201,0701,0901") //Empresas e Filiais para no considerar no Relatório
  // Local aMVEFex := StrTokArr(cMVEFex,',')  
  // Local _aEmFlEx:= {}
	// Local _i := 0
	// Local cCGC_M0	:= ''
	// Local _MVCGC	:= ''
	// Local aFil_In	:= {}
	Local _aFields := {}
	Local _aIndex	:= {}
	Local cTabQry	
	Local cTabQry2
	Local cTabQry3
	Local cFilDest
	Local cSerDest
	Local cNFDest	
	Local cItDest	
	Local cCdFDest

	Local cMsgObs	:= ''
	Local cCodErr := ''

  Private oExcel		:= FWMSEXCELEX():New()
  Private oMsExcel	:= NIL
  Private cWrksht1	:= 'Resumo'
  Private cWrksht2	:= 'Detalhamento'

  Private cPlan01		:= "Resumo da Conferência Escrituração Fiscal no grupo Adoro - "+ ' (' + StrZero(Month(_mvpr01),2) +'/'+Alltrim(Str(Year(_mvpr01))) +')'
  Private cPlan02		:= "Detalhamento das Operações - "+ ' (' + StrZero(Month(_mvpr01),2) +'/'+Alltrim(Str(Year(_mvpr01))) +')'

  Private cQuery1
	Private cQuery2
	Private cQuery3
	Private cQuery4

	Private cQuery5
	Private cQuery6

	Private oAlRes
	Private cAlResum 
	Private oAlDet
	Private cAlDetal

	Private aResumo := {}

  Private cArquivo  := Alltrim(CRELPATH) +  'RCONFESCFIS_' + DTOS(DATE()) + STRTRAN(TIME(),':','') + '.XML'

	// IF Len(aMVEFex) == 0
	// 	Aviso("ADFIS043R-01","Nenhuma empresa / filial encontrada no parâmetro MV_FIS43R. Impossível contrinuar.",{"OK"},3)
	// 	Return
	// ENDIF

	// FOR _i := 1 to Len(aMVEFex)
	// 	cCGC_M0 += FWSM0Util():GetSM0Data( Substr(aMVEFex[_i],1,2) , Substr(aMVEFex[_i],3,2) , { "M0_CGC" } )[1,2] + ','
		
	// 	IF !ASCAN(aFil_In, {|X| X[1] == aMVEFex[_i]})
	// 		AADD(aFil_In,{aMVEFex[_i],Substr(aMVEFex[_i],1,2),Substr(aMVEFex[_i],3,2)})
	// 	ENDIF
	
	// NEXT _i
	// ASORT(aFil_In)

	// _MVCGC	:= '%'+FormatIn(cCGC_M0,",")+'%'

  IF .NOT.( ApOleClient("MsExcel") )   // se nao existir o excel sai fora..
    Alert("Nao Existe Excel Instalado")
    BREAK
  EndIF
/**/
	MsProcTxt("Carregando Dados - Adoro ...")
	cQuery1 :=  GetNextAlias()
	BeginSql Alias cQuery1
		COLUMN FT_EMISSAO AS DATE
		COLUMN FT_ENTRADA AS DATE
		COLUMN F3_DTCANC	AS DATE
		SELECT 
			'01'					AS EMPRESA_ORIGEM,
			SFT.FT_FILIAL	AS FILIAL_ORIGEM,
			CASE 
				WHEN FT_FILIAL = '01' THEN '60037058000131'
				WHEN FT_FILIAL = '02' THEN '60037058000301'
				WHEN FT_FILIAL = '03' THEN '60037058000484'
				WHEN FT_FILIAL = '04' THEN '60037058000999'
				WHEN FT_FILIAL = '05' THEN '60037058001880'
				WHEN FT_FILIAL = '06' THEN '60037058001960'
				WHEN FT_FILIAL = '07' THEN '60037058002002'
				WHEN FT_FILIAL = '08' THEN '60037058002185'
				WHEN FT_FILIAL = '09' THEN '60037058002266'
				WHEN FT_FILIAL = '0A' THEN '60037058002347' //Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN FT_FILIAL = '0B' THEN '60037058002428' //Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
			END						AS CGC_ORIGEM,
			CASE 
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000131' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000301' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000484' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000999' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001880' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001960' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002002' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002185' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002266' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002347' THEN '01'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002428' THEN '01'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '02090384000106' THEN '02'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '12097672000146' THEN '07'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '20052541000170' THEN '09'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000131' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000301' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000484' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000999' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001880' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001960' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002002' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002185' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002266' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002347' THEN '01'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002428' THEN '01'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '02090384000106' THEN '02'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '12097672000146' THEN '07'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '20052541000170' THEN '09'
			END AS EMPRESA_DESTINO,
			CASE 
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000131' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000301' THEN '02'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000484' THEN '03'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000999' THEN '04'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001880' THEN '05'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001960' THEN '06'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002002' THEN '07'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002185' THEN '08'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002266' THEN '09'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002347' THEN '0A'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002428' THEN '0B'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '02090384000106' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '12097672000146' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '20052541000170' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000131' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000301' THEN '02'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000484' THEN '03'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000999' THEN '04'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001880' THEN '05'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001960' THEN '06'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002002' THEN '07'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002185' THEN '08'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002266' THEN '09'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002347' THEN '0A'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002428' THEN '0B'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '02090384000106' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '12097672000146' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '20052541000170' THEN '01'
			END AS FILIAL_DESTINO,
			CASE WHEN SFT.FT_TIPO IN ('D','B') THEN SA2.A2_CGC ELSE SA1.A1_CGC END AS CGC_DESTINO,
			CASE WHEN SFT.FT_TIPO IN ('D','B') THEN SA2.A2_NOME ELSE SA1.A1_NOME END AS NOME_DESTINO,
			CASE 
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000131' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058000131' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000301' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058000301' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000484' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058000484' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000999' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058000999' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001880' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058001880' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001960' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058001960' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002002' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002002' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002185' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002185' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002266' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002266' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002347' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002347' AND SA22.%notDel%)//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002428' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002428' AND SA22.%notDel%)//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '02090384000106' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2020 SA22 WHERE SA22.A2_CGC = '02090384000106' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '12097672000146' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2070 SA22 WHERE SA22.A2_CGC = '12097672000146' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '20052541000170' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2090 SA22 WHERE SA22.A2_CGC = '20052541000170' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000131' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058000131' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000301' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058000301' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000484' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058000484' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000999' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058000999' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001880' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058001880' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001960' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058001960' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002002' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002002' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002185' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002185' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002266' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002266' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002347' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002347' AND SA12.%notDel%)//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002428' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002428' AND SA12.%notDel%)//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '02090384000106' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1020 SA12 WHERE SA12.A1_CGC = '02090384000106' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '12097672000146' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1070 SA12 WHERE SA12.A1_CGC = '12097672000146' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '20052541000170' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1090 SA12 WHERE SA12.A1_CGC = '20052541000170' AND SA12.%notDel%)
			END AS CODIGO_FORN_DESTINO,
			SFT.FT_NFISCAL	AS FT_NFISCAL,
			REPLACE(SFT.FT_SERIE,'0','') AS FT_SERIE,
			REPLACE(SFT.FT_ITEM,'0','')	AS FT_ITEM,
			SFT.FT_CLIEFOR	AS FT_CLIEFOR,
			SFT.FT_LOJA			AS FT_LOJA,
			SFT.FT_TIPO			AS FT_TIPO,
			SFT.FT_ENTRADA	AS FT_ENTRADA,
			SFT.FT_EMISSAO	AS FT_EMISSAO,
			SFT.FT_PRODUTO	AS FT_PRODUTO,
			SB1.B1_DESC			AS B1_DESC,
			SFT.FT_QUANT		AS FT_QUANT,
			SFT.FT_PRCUNIT	AS FT_PRCUNIT,
			SFT.FT_VALCONT	AS FT_VALCONT,
			SFT.FT_BASEICM	AS FT_BASEICM,
			SFT.FT_ALIQICM	AS FT_ALIQICM,
			SFT.FT_VALICM		AS FT_VALICM,
			SFT.FT_OUTRICM	AS FT_OUTRICM,
			SFT.FT_BASEPIS	AS FT_BASEPIS,
			SFT.FT_BASECOF	AS FT_BASECOF,
			SFT.FT_ALIQPIS	AS FT_ALIQPIS,
			SFT.FT_ALIQCOF	AS FT_ALIQCOF,
			SFT.FT_VALPIS		AS FT_VALPIS,
			SFT.FT_VALCOF		AS FT_VALCOF,
			SFT.FT_TES			AS FT_TES,
			SFT.FT_CFOP			AS FT_CFOP,
			SFT.FT_CSTPIS		AS FT_CSTPIS,
			SFT.FT_CSTCOF		AS FT_CSTCOF,
			SF3.F3_CODRSEF	AS F3_CODRSEF,
			SF3.F3_DTCANC		AS F3_DTCANC
		FROM SFT010 SFT (NOLOCK)
			LEFT JOIN SA2010 SA2 (NOLOCK) ON
				SA2.A2_COD = SFT.FT_CLIEFOR
				AND SA2.A2_LOJA = SFT.FT_LOJA
				AND SFT.FT_TIPO IN ('D','B')
				AND SA2.%notDel%
			LEFT JOIN SA1010 SA1 (NOLOCK) ON
				SA1.A1_COD = SFT.FT_CLIEFOR
				AND SA1.A1_LOJA = SFT.FT_LOJA
				AND SFT.FT_TIPO NOT IN ('D','B')
				AND SA1.%notDel%
			LEFT JOIN SB1010 SB1 (NOLOCK) ON
				SB1.B1_COD = SFT.FT_PRODUTO
				AND SB1.%notDel%
			LEFT JOIN SF3010 SF3 (NOLOCK) ON
				SF3.F3_FILIAL = SFT.FT_FILIAL
				AND SF3.F3_SERIE = SFT.FT_SERIE
				AND SF3.F3_NFISCAL = SFT.FT_NFISCAL
				AND SF3.F3_CLIEFOR = SFT.FT_CLIEFOR
				AND SF3.F3_LOJA = SFT.FT_LOJA
				AND SF3.F3_IDENTFT = SFT.FT_IDENTF3
				AND SF3.%notDel%
		WHERE 
			SFT.FT_ENTRADA BETWEEN %Exp:DTOS(_mvpr01)% AND %Exp:DTOS(_mvpr02)%
			AND SFT.FT_CFOP > '5000'
			AND SFT.%notDel%
			AND ( SA1.A1_CGC IN	(	'60037058000131',
														'60037058000301',
														'60037058000484',
														'60037058000999',
														'60037058001880',
														'60037058001960',
														'60037058002002',
														'60037058002185',
														'60037058002266',
														'60037058002347',//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
														'60037058002428',//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
														'02090384000106',
														'12097672000146',
														'20052541000170') OR
						SA2.A2_CGC IN	(	'60037058000131',
														'60037058000301',
														'60037058000484',
														'60037058000999',
														'60037058001880',
														'60037058001960',
														'60037058002002',
														'60037058002185',
														'60037058002266',
														'60037058002347',//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
														'60037058002428',//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
														'02090384000106',
														'12097672000146',
														'20052541000170')
						)
	EndSql
	
	MsProcTxt("Carregando Dados - Ceres ...")
	cQuery2 :=  GetNextAlias()
	BeginSql Alias cQuery2
		COLUMN FT_EMISSAO AS DATE
		COLUMN FT_ENTRADA AS DATE
		COLUMN F3_DTCANC	AS DATE
		SELECT 
			'02'					AS EMPRESA_ORIGEM,
			SFT.FT_FILIAL	AS FILIAL_ORIGEM,
			CASE 
				WHEN FT_FILIAL = '01' THEN '02090384000106'
			END						AS CGC_ORIGEM,
			CASE 
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000131' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000301' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000484' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000999' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001880' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001960' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002002' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002185' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002266' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002347' THEN '01'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002428' THEN '01'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '02090384000106' THEN '02'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '12097672000146' THEN '07'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '20052541000170' THEN '09'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000131' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000301' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000484' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000999' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001880' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001960' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002002' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002185' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002266' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002347' THEN '01'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002428' THEN '01'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '02090384000106' THEN '02'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '12097672000146' THEN '07'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '20052541000170' THEN '09'
			END AS EMPRESA_DESTINO,
			CASE 
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000131' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000301' THEN '02'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000484' THEN '03'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000999' THEN '04'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001880' THEN '05'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001960' THEN '06'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002002' THEN '07'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002185' THEN '08'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002266' THEN '09'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002347' THEN '0A'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002428' THEN '0B'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '02090384000106' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '12097672000146' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '20052541000170' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000131' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000301' THEN '02'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000484' THEN '03'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000999' THEN '04'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001880' THEN '05'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001960' THEN '06'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002002' THEN '07'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002185' THEN '08'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002266' THEN '09'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002347' THEN '0A'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002428' THEN '0B'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '02090384000106' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '12097672000146' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '20052541000170' THEN '01'
			END AS FILIAL_DESTINO,
			CASE 
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000131' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058000131' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000301' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058000301' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000484' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058000484' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000999' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058000999' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001880' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058001880' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001960' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058001960' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002002' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002002' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002185' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002185' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002266' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002266' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002347' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002347' AND SA22.%notDel%)//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002428' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002428' AND SA22.%notDel%)//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '02090384000106' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2020 SA22 WHERE SA22.A2_CGC = '02090384000106' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '12097672000146' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2070 SA22 WHERE SA22.A2_CGC = '12097672000146' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '20052541000170' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2090 SA22 WHERE SA22.A2_CGC = '20052541000170' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000131' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058000131' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000301' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058000301' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000484' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058000484' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000999' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058000999' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001880' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058001880' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001960' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058001960' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002002' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002002' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002185' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002185' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002266' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002266' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002347' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002347' AND SA12.%notDel%)//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002428' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002428' AND SA12.%notDel%)//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '02090384000106' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1020 SA12 WHERE SA12.A1_CGC = '02090384000106' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '12097672000146' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1070 SA12 WHERE SA12.A1_CGC = '12097672000146' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '20052541000170' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1090 SA12 WHERE SA12.A1_CGC = '20052541000170' AND SA12.%notDel%)
			END AS CODIGO_FORN_DESTINO,
			CASE WHEN SFT.FT_TIPO IN ('D','B') THEN SA2.A2_CGC ELSE SA1.A1_CGC END AS CGC_DESTINO,
			CASE WHEN SFT.FT_TIPO IN ('D','B') THEN SA2.A2_NOME ELSE SA1.A1_NOME END AS NOME_DESTINO,
			SFT.FT_NFISCAL	AS FT_NFISCAL,
			REPLACE(SFT.FT_SERIE,'0','') AS FT_SERIE,
			REPLACE(SFT.FT_ITEM,'0','')	AS FT_ITEM,
			SFT.FT_CLIEFOR	AS FT_CLIEFOR,
			SFT.FT_LOJA			AS FT_LOJA,
			SFT.FT_TIPO		AS FT_TIPO,
			SFT.FT_ENTRADA	AS FT_ENTRADA,
			SFT.FT_EMISSAO	AS FT_EMISSAO,
			SFT.FT_PRODUTO	AS FT_PRODUTO,
			SB1.B1_DESC			AS B1_DESC,
			SFT.FT_QUANT	AS FT_QUANT,
			SFT.FT_PRCUNIT	AS FT_PRCUNIT,
			SFT.FT_VALCONT	AS FT_VALCONT,
			SFT.FT_BASEICM	AS FT_BASEICM,
			SFT.FT_ALIQICM	AS FT_ALIQICM,
			SFT.FT_VALICM	AS FT_VALICM,
			SFT.FT_OUTRICM	AS FT_OUTRICM,
			SFT.FT_BASEPIS	AS FT_BASEPIS,
			SFT.FT_BASECOF	AS FT_BASECOF,
			SFT.FT_ALIQPIS	AS FT_ALIQPIS,
			SFT.FT_ALIQCOF	AS FT_ALIQCOF,
			SFT.FT_VALPIS	AS FT_VALPIS,
			SFT.FT_VALCOF	AS FT_VALCOF,
			SFT.FT_TES		AS FT_TES,
			SFT.FT_CFOP		AS FT_CFOP,
			SFT.FT_CSTPIS		AS FT_CSTPIS,
			SFT.FT_CSTCOF		AS FT_CSTCOF,
			SF3.F3_CODRSEF		AS F3_CODRSEF,
			SF3.F3_DTCANC		AS F3_DTCANC
		FROM SFT020 SFT (NOLOCK)
			LEFT JOIN SA2020 SA2 (NOLOCK) ON
				SA2.A2_COD = SFT.FT_CLIEFOR
				AND SA2.A2_LOJA = SFT.FT_LOJA
				AND SFT.FT_TIPO IN ('D','B')
				AND SA2.%notDel%
			LEFT JOIN SA1020 SA1 (NOLOCK) ON
				SA1.A1_COD = SFT.FT_CLIEFOR
				AND SA1.A1_LOJA = SFT.FT_LOJA
				AND SFT.FT_TIPO NOT IN ('D','B')
				AND SA1.%notDel%
			LEFT JOIN SB1020 SB1 (NOLOCK) ON
				SB1.B1_COD = SFT.FT_PRODUTO
				AND SB1.%notDel%
			LEFT JOIN SF3020 SF3 (NOLOCK) ON
				SF3.F3_FILIAL = SFT.FT_FILIAL
				AND SF3.F3_SERIE = SFT.FT_SERIE
				AND SF3.F3_NFISCAL = SFT.FT_NFISCAL
				AND SF3.F3_CLIEFOR = SFT.FT_CLIEFOR
				AND SF3.F3_LOJA = SFT.FT_LOJA
				AND SF3.F3_IDENTFT = SFT.FT_IDENTF3
				AND SF3.%notDel%
		WHERE 
			SFT.FT_ENTRADA BETWEEN %Exp:DTOS(_mvpr01)% AND %Exp:DTOS(_mvpr02)%
			AND SFT.FT_CFOP > '5000'
			AND SFT.%notDel%
			AND ( SA1.A1_CGC IN	(	'60037058000131',
														'60037058000301',
														'60037058000484',
														'60037058000999',
														'60037058001880',
														'60037058001960',
														'60037058002002',
														'60037058002185',
														'60037058002266',
														'60037058002347',//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
														'60037058002428',//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
														'02090384000106',
														'12097672000146',
														'20052541000170') OR
						SA2.A2_CGC IN	(	'60037058000131',
														'60037058000301',
														'60037058000484',
														'60037058000999',
														'60037058001880',
														'60037058001960',
														'60037058002002',
														'60037058002185',
														'60037058002266',
														'60037058002347',//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
														'60037058002428',//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
														'02090384000106',
														'12097672000146',
														'20052541000170')
						)
	EndSql

	MsProcTxt("Carregando Dados - RNX2 ...")
	cQuery3 :=  GetNextAlias()
	BeginSql Alias cQuery3
		COLUMN FT_EMISSAO AS DATE
		COLUMN FT_ENTRADA AS DATE
		COLUMN F3_DTCANC	AS DATE
		SELECT 
			'07'					AS EMPRESA_ORIGEM,
			SFT.FT_FILIAL	AS FILIAL_ORIGEM,
			CASE 
				WHEN FT_FILIAL = '01' THEN '12097672000146'
			END						AS CGC_ORIGEM,
			CASE 
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000131' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000301' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000484' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000999' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001880' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001960' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002002' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002185' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002266' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002347' THEN '01'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002428' THEN '01'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '02090384000106' THEN '02'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '12097672000146' THEN '07'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '20052541000170' THEN '09'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000131' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000301' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000484' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000999' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001880' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001960' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002002' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002185' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002266' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002347' THEN '01'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002428' THEN '01'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira				
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '02090384000106' THEN '02'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '12097672000146' THEN '07'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '20052541000170' THEN '09'
			END AS EMPRESA_DESTINO,
			CASE 
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000131' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000301' THEN '02'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000484' THEN '03'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000999' THEN '04'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001880' THEN '05'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001960' THEN '06'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002002' THEN '07'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002185' THEN '08'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002266' THEN '09'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002347' THEN '0A'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002428' THEN '0B'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '02090384000106' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '12097672000146' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '20052541000170' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000131' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000301' THEN '02'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000484' THEN '03'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000999' THEN '04'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001880' THEN '05'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001960' THEN '06'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002002' THEN '07'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002185' THEN '08'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002266' THEN '09'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002347' THEN '0A'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002428' THEN '0B'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '02090384000106' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '12097672000146' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '20052541000170' THEN '01'
			END AS FILIAL_DESTINO,
			CASE 
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000131' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058000131' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000301' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058000301' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000484' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058000484' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000999' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058000999' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001880' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058001880' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001960' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058001960' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002002' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002002' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002185' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002185' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002266' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002266' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002347' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002347' AND SA22.%notDel%)//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002428' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002428' AND SA22.%notDel%)//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '02090384000106' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2020 SA22 WHERE SA22.A2_CGC = '02090384000106' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '12097672000146' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2070 SA22 WHERE SA22.A2_CGC = '12097672000146' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '20052541000170' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2090 SA22 WHERE SA22.A2_CGC = '20052541000170' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000131' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058000131' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000301' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058000301' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000484' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058000484' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000999' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058000999' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001880' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058001880' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001960' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058001960' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002002' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002002' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002185' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002185' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002266' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002266' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002347' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002347' AND SA12.%notDel%)//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002428' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002428' AND SA12.%notDel%)//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '02090384000106' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1020 SA12 WHERE SA12.A1_CGC = '02090384000106' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '12097672000146' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1070 SA12 WHERE SA12.A1_CGC = '12097672000146' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '20052541000170' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1090 SA12 WHERE SA12.A1_CGC = '20052541000170' AND SA12.%notDel%)
			END AS CODIGO_FORN_DESTINO,
			CASE WHEN SFT.FT_TIPO IN ('D','B') THEN SA2.A2_CGC ELSE SA1.A1_CGC END AS CGC_DESTINO,
			CASE WHEN SFT.FT_TIPO IN ('D','B') THEN SA2.A2_NOME ELSE SA1.A1_NOME END AS NOME_DESTINO,
			SFT.FT_NFISCAL	AS FT_NFISCAL,
			REPLACE(SFT.FT_SERIE,'0','') AS FT_SERIE,
			REPLACE(SFT.FT_ITEM,'0','')	AS FT_ITEM,
			SFT.FT_CLIEFOR	AS FT_CLIEFOR,
			SFT.FT_LOJA			AS FT_LOJA,
			SFT.FT_TIPO		AS FT_TIPO,
			SFT.FT_ENTRADA	AS FT_ENTRADA,
			SFT.FT_EMISSAO	AS FT_EMISSAO,
			SFT.FT_PRODUTO	AS FT_PRODUTO,
			SB1.B1_DESC			AS B1_DESC,
			SFT.FT_QUANT	AS FT_QUANT,
			SFT.FT_PRCUNIT	AS FT_PRCUNIT,
			SFT.FT_VALCONT	AS FT_VALCONT,
			SFT.FT_BASEICM	AS FT_BASEICM,
			SFT.FT_ALIQICM	AS FT_ALIQICM,
			SFT.FT_VALICM	AS FT_VALICM,
			SFT.FT_OUTRICM	AS FT_OUTRICM,
			SFT.FT_BASEPIS	AS FT_BASEPIS,
			SFT.FT_BASECOF	AS FT_BASECOF,
			SFT.FT_ALIQPIS	AS FT_ALIQPIS,
			SFT.FT_ALIQCOF	AS FT_ALIQCOF,
			SFT.FT_VALPIS	AS FT_VALPIS,
			SFT.FT_VALCOF	AS FT_VALCOF,
			SFT.FT_TES		AS FT_TES,
			SFT.FT_CFOP		AS FT_CFOP,
			SFT.FT_CSTPIS		AS FT_CSTPIS,
			SFT.FT_CSTCOF		AS FT_CSTCOF,
			SF3.F3_CODRSEF		AS F3_CODRSEF,
			SF3.F3_DTCANC		AS F3_DTCANC
		FROM SFT070 SFT (NOLOCK)
			LEFT JOIN SA2070 SA2 (NOLOCK) ON
				SA2.A2_COD = SFT.FT_CLIEFOR
				AND SA2.A2_LOJA = SFT.FT_LOJA
				AND SFT.FT_TIPO IN ('D','B')
				AND SA2.%notDel%
			LEFT JOIN SA1070 SA1 (NOLOCK) ON
				SA1.A1_COD = SFT.FT_CLIEFOR
				AND SA1.A1_LOJA = SFT.FT_LOJA
				AND SFT.FT_TIPO NOT IN ('D','B')
				AND SA1.%notDel%
			LEFT JOIN SB1070 SB1 (NOLOCK) ON
				SB1.B1_COD = SFT.FT_PRODUTO
				AND SB1.%notDel%
			LEFT JOIN SF3070 SF3 (NOLOCK) ON
				SF3.F3_FILIAL = SFT.FT_FILIAL
				AND SF3.F3_SERIE = SFT.FT_SERIE
				AND SF3.F3_NFISCAL = SFT.FT_NFISCAL
				AND SF3.F3_CLIEFOR = SFT.FT_CLIEFOR
				AND SF3.F3_LOJA = SFT.FT_LOJA
				AND SF3.F3_IDENTFT = SFT.FT_IDENTF3
				AND SF3.%notDel%
		WHERE 
			SFT.FT_ENTRADA BETWEEN %Exp:DTOS(_mvpr01)% AND %Exp:DTOS(_mvpr02)%
			AND SFT.FT_CFOP > '5000'
			AND SFT.%notDel%
			AND ( SA1.A1_CGC IN	(	'60037058000131',
														'60037058000301',
														'60037058000484',
														'60037058000999',
														'60037058001880',
														'60037058001960',
														'60037058002002',
														'60037058002185',
														'60037058002266',
														'60037058002347',//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
														'60037058002428',//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
														'02090384000106',
														'12097672000146',
														'20052541000170') OR
						SA2.A2_CGC IN	(	'60037058000131',
														'60037058000301',
														'60037058000484',
														'60037058000999',
														'60037058001880',
														'60037058001960',
														'60037058002002',
														'60037058002185',
														'60037058002266',
														'60037058002347',//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
														'60037058002428',//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
														'02090384000106',
														'12097672000146',
														'20052541000170')
						)
	EndSql
/**/
	MsProcTxt("Carregando Dados - SAFEGG ...")
	cQuery4 :=  GetNextAlias()
	BeginSql Alias cQuery4
		COLUMN FT_EMISSAO AS DATE
		COLUMN FT_ENTRADA AS DATE
		COLUMN F3_DTCANC	AS DATE
		SELECT 
			'09'					AS EMPRESA_ORIGEM,
			SFT.FT_FILIAL	AS FILIAL_ORIGEM,
			CASE 
				WHEN FT_FILIAL = '01' THEN '20052541000170'
			END						AS CGC_ORIGEM,
			CASE 
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000131' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000301' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000484' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000999' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001880' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001960' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002002' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002185' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002266' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002347' THEN '01'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002428' THEN '01'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '02090384000106' THEN '02'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '12097672000146' THEN '07'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '20052541000170' THEN '09'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000131' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000301' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000484' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000999' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001880' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001960' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002002' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002185' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002266' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002347' THEN '01'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002428' THEN '01'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira				
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '02090384000106' THEN '02'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '12097672000146' THEN '07'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '20052541000170' THEN '09'
			END AS EMPRESA_DESTINO,
			CASE 
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000131' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000301' THEN '02'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000484' THEN '03'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000999' THEN '04'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001880' THEN '05'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001960' THEN '06'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002002' THEN '07'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002185' THEN '08'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002266' THEN '09'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002347' THEN '0A'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002428' THEN '0B'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '02090384000106' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '12097672000146' THEN '01'
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '20052541000170' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000131' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000301' THEN '02'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000484' THEN '03'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000999' THEN '04'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001880' THEN '05'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001960' THEN '06'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002002' THEN '07'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002185' THEN '08'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002266' THEN '09'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002347' THEN '0A'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002428' THEN '0B'//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '02090384000106' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '12097672000146' THEN '01'
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '20052541000170' THEN '01'
			END AS FILIAL_DESTINO,
			CASE 
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000131' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058000131' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000301' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058000301' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000484' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058000484' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058000999' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058000999' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001880' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058001880' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058001960' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058001960' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002002' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002002' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002185' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002185' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002266' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002266' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002347' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002347' AND SA22.%notDel%)//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '60037058002428' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2010 SA22 WHERE SA22.A2_CGC = '60037058002428' AND SA22.%notDel%)//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '02090384000106' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2020 SA22 WHERE SA22.A2_CGC = '02090384000106' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '12097672000146' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2070 SA22 WHERE SA22.A2_CGC = '12097672000146' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO IN ('D','B') AND SA2.A2_CGC = '20052541000170' THEN (SELECT TOP 1 SA22.A2_COD+SA22.A2_LOJA FROM SA2090 SA22 WHERE SA22.A2_CGC = '20052541000170' AND SA22.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000131' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058000131' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000301' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058000301' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000484' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058000484' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058000999' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058000999' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001880' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058001880' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058001960' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058001960' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002002' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002002' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002185' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002185' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002266' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002266' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002347' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002347' AND SA12.%notDel%)//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '60037058002428' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1010 SA12 WHERE SA12.A1_CGC = '60037058002428' AND SA12.%notDel%)//Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '02090384000106' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1020 SA12 WHERE SA12.A1_CGC = '02090384000106' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '12097672000146' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1070 SA12 WHERE SA12.A1_CGC = '12097672000146' AND SA12.%notDel%)
				WHEN SFT.FT_TIPO NOT IN ('D','B') AND SA1.A1_CGC = '20052541000170' THEN (SELECT TOP 1 SA12.A1_COD+SA12.A1_LOJA FROM SA1090 SA12 WHERE SA12.A1_CGC = '20052541000170' AND SA12.%notDel%)
			END AS CODIGO_FORN_DESTINO,
			CASE WHEN SFT.FT_TIPO IN ('D','B') THEN SA2.A2_CGC ELSE SA1.A1_CGC END AS CGC_DESTINO,
			CASE WHEN SFT.FT_TIPO IN ('D','B') THEN SA2.A2_NOME ELSE SA1.A1_NOME END AS NOME_DESTINO,
			SFT.FT_NFISCAL	AS FT_NFISCAL,
			REPLACE(SFT.FT_SERIE,'0','') AS FT_SERIE,
			REPLACE(SFT.FT_ITEM,'0','')	AS FT_ITEM,
			SFT.FT_CLIEFOR	AS FT_CLIEFOR,
			SFT.FT_LOJA			AS FT_LOJA,
			SFT.FT_TIPO		AS FT_TIPO,
			SFT.FT_ENTRADA	AS FT_ENTRADA,
			SFT.FT_EMISSAO	AS FT_EMISSAO,
			SFT.FT_PRODUTO	AS FT_PRODUTO,
			SB1.B1_DESC			AS B1_DESC,
			SFT.FT_QUANT	AS FT_QUANT,
			SFT.FT_PRCUNIT	AS FT_PRCUNIT,
			SFT.FT_VALCONT	AS FT_VALCONT,
			SFT.FT_BASEICM	AS FT_BASEICM,
			SFT.FT_ALIQICM	AS FT_ALIQICM,
			SFT.FT_VALICM	AS FT_VALICM,
			SFT.FT_OUTRICM	AS FT_OUTRICM,
			SFT.FT_BASEPIS	AS FT_BASEPIS,
			SFT.FT_BASECOF	AS FT_BASECOF,
			SFT.FT_ALIQPIS	AS FT_ALIQPIS,
			SFT.FT_ALIQCOF	AS FT_ALIQCOF,
			SFT.FT_VALPIS	AS FT_VALPIS,
			SFT.FT_VALCOF	AS FT_VALCOF,
			SFT.FT_TES		AS FT_TES,
			SFT.FT_CFOP		AS FT_CFOP,
			SFT.FT_CSTPIS		AS FT_CSTPIS,
			SFT.FT_CSTCOF		AS FT_CSTCOF,
			SF3.F3_CODRSEF		AS F3_CODRSEF,
			SF3.F3_DTCANC		AS F3_DTCANC
		FROM SFT090 SFT (NOLOCK)
			LEFT JOIN SA2090 SA2 (NOLOCK) ON
				SA2.A2_COD = SFT.FT_CLIEFOR
				AND SA2.A2_LOJA = SFT.FT_LOJA
				AND SFT.FT_TIPO IN ('D','B')
				AND SA2.%notDel%
			LEFT JOIN SA1090 SA1 (NOLOCK) ON
				SA1.A1_COD = SFT.FT_CLIEFOR
				AND SA1.A1_LOJA = SFT.FT_LOJA
				AND SFT.FT_TIPO NOT IN ('D','B')
				AND SA1.%notDel%
			LEFT JOIN SB1090 SB1 (NOLOCK) ON
				SB1.B1_COD = SFT.FT_PRODUTO
				AND SB1.%notDel%
			LEFT JOIN SF3090 SF3 (NOLOCK) ON
				SF3.F3_FILIAL = SFT.FT_FILIAL
				AND SF3.F3_SERIE = SFT.FT_SERIE
				AND SF3.F3_NFISCAL = SFT.FT_NFISCAL
				AND SF3.F3_CLIEFOR = SFT.FT_CLIEFOR
				AND SF3.F3_LOJA = SFT.FT_LOJA
				AND SF3.F3_IDENTFT = SFT.FT_IDENTF3
				AND SF3.%notDel%
		WHERE 
			SFT.FT_ENTRADA BETWEEN %Exp:DTOS(_mvpr01)% AND %Exp:DTOS(_mvpr02)%
			AND SFT.FT_CFOP > '5000'
			AND SFT.%notDel%
			AND ( SA1.A1_CGC IN	(	'60037058000131',
														'60037058000301',
														'60037058000484',
														'60037058000999',
														'60037058001880',
														'60037058001960',
														'60037058002002',
														'60037058002185',
														'60037058002266',
														'60037058002347', //Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
														'60037058002428', //Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
														'02090384000106',
														'12097672000146',
														'20052541000170') OR
						SA2.A2_CGC IN	(	'60037058000131',
														'60037058000301',
														'60037058000484',
														'60037058000999',
														'60037058001880',
														'60037058001960',
														'60037058002002',
														'60037058002185',
														'60037058002266',
														'60037058002347', //Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
														'60037058002428', //Ticket 72256     - Abel Babini - 02/05/2022 - Acrescentar Filiais HH e Itapira
														'02090384000106',
														'12097672000146',
														'20052541000170')
						)
	EndSql
/**/
	//Cria Estrutura da Tabela Temporária
	cAlResum:=GetNextAlias()
	_aFields	:= CriaExtr('RESUMO')
	_aIndex		:= CriaInd('RESUMO')
	oAlRes	:= CriaTmpT(cAlResum, _aFields, _aIndex)

	cAlDetal:=GetNextAlias()
	_aFields	:= CriaExtr('DETALHE')
	_aIndex		:= CriaInd('DETALHE')
	oAlDet	:= CriaTmpT(cAlDetal, _aFields, _aIndex)
/**/
	MsProcTxt("Processando Dados - Adoro ...")
	//Popula Tabela Temporária - Empresa 01
	(cQuery1)->(dbGoTop())
	WHILE !(cQuery1)->(eof())
		//Apenas se Empresa+Filial de Origem for diferente da Empresa+Filial de Destino
		IF (cQuery1)->EMPRESA_ORIGEM+(cQuery1)->FILIAL_ORIGEM <> (cQuery1)->EMPRESA_DESTINO+(cQuery1)->FILIAL_DESTINO
			//Localiza escrituração no destino
			cQuery5 :=  GetNextAlias()
			cTabQry	:= '%'+'SFT'+(cQuery1)->EMPRESA_DESTINO+'0'+'%'
			cTabQry2:= '%'+'SA1'+(cQuery1)->EMPRESA_DESTINO+'0'+'%'
			cTabQry3:= '%'+'SA2'+(cQuery1)->EMPRESA_DESTINO+'0'+'%'
			cFilDest:= (cQuery1)->FILIAL_DESTINO
			cSerDest:= (cQuery1)->FT_SERIE
			cNFDest	:= (cQuery1)->FT_NFISCAL
			cItDest	:= (cQuery1)->FT_ITEM
			cCdFDest:= (cQuery1)->CGC_ORIGEM

			BeginSql Alias cQuery5
				COLUMN FT_EMISSAO AS DATE
				COLUMN FT_ENTRADA AS DATE
				SELECT 
					SFT.FT_SERIE	AS FT_SERIE,
					SFT.FT_NFISCAL	AS FT_NFISCAL,
					REPLACE(SFT.FT_ITEM,'0','')	AS FT_ITEM,
					SFT.FT_TIPO		AS FT_TIPO,
					SFT.FT_ENTRADA	AS FT_ENTRADA,
					SFT.FT_EMISSAO	AS FT_EMISSAO,
					SFT.FT_PRODUTO	AS FT_PRODUTO,
					SFT.FT_QUANT	AS FT_QUANT,
					SFT.FT_PRCUNIT	AS FT_PRCUNIT,
					SFT.FT_VALCONT	AS FT_VALCONT,
					SFT.FT_BASEICM	AS FT_BASEICM,
					SFT.FT_ALIQICM	AS FT_ALIQICM,
					SFT.FT_VALICM	AS FT_VALICM,
					SFT.FT_OUTRICM	AS FT_OUTRICM,
					SFT.FT_BASEPIS	AS FT_BASEPIS,
					SFT.FT_BASECOF	AS FT_BASECOF,
					SFT.FT_ALIQPIS	AS FT_ALIQPIS,
					SFT.FT_ALIQCOF	AS FT_ALIQCOF,
					SFT.FT_VALPIS	AS FT_VALPIS,
					SFT.FT_VALCOF	AS FT_VALCOF,
					SFT.FT_TES		AS FT_TES,
					SFT.FT_CFOP		AS FT_CFOP,
					SFT.FT_CSTPIS		AS FT_CSTPIS,
					SFT.FT_CSTCOF		AS FT_CSTCOF
				FROM %Exp:cTabQry% SFT (NOLOCK)
					LEFT JOIN %Exp:cTabQry2% SA1 (NOLOCK) ON
						SA1.A1_COD = SFT.FT_CLIEFOR
						AND SA1.A1_LOJA = SFT.FT_LOJA
						AND SFT.FT_TIPO IN ('D','B')
						AND SA1.%notDel%
					LEFT JOIN %Exp:cTabQry3% SA2 (NOLOCK) ON
						SA2.A2_COD = SFT.FT_CLIEFOR
						AND SA2.A2_LOJA = SFT.FT_LOJA
						AND SFT.FT_TIPO NOT IN ('D','B')
						AND SA2.%notDel%
				WHERE
					SFT.FT_FILIAL = %Exp:cFilDest%
					AND RTRIM(LTRIM(REPLACE(SFT.FT_SERIE,'0',''))) = RTRIM(LTRIM(REPLACE(%Exp:cSerDest%,'0',''))) //Everson - 30/09/2020. Chamado 25.
					AND SFT.FT_NFISCAL = %Exp:cNFDest%
					AND RTRIM(LTRIM(REPLACE(SFT.FT_ITEM,'0',''))) = RTRIM(LTRIM(%Exp:cItDest%))
					AND SFT.FT_CFOP < '5000'
					AND (SA1.A1_CGC = %Exp:cCdFDest% OR SA2.A2_CGC = %Exp:cCdFDest%)
					AND SFT.%notDel%
			EndSql

			RECLOCK(cAlDetal,.T.)
				(cAlDetal)->EMPORIGEM		:= (cQuery1)->EMPRESA_ORIGEM
				(cAlDetal)->FILORIGEM		:= (cQuery1)->FILIAL_ORIGEM
				(cAlDetal)->CGCORIGEM		:= (cQuery1)->CGC_ORIGEM
				(cAlDetal)->NOMORIGEM		:= xNomOri((cQuery1)->EMPRESA_ORIGEM,(cQuery1)->FILIAL_ORIGEM)
				(cAlDetal)->SERIEORI		:= (cQuery1)->FT_SERIE
				(cAlDetal)->NFISCALORI	:= (cQuery1)->FT_NFISCAL
				(cAlDetal)->ITEMORI			:= (cQuery1)->FT_ITEM
				(cAlDetal)->TIPOORI			:= (cQuery1)->FT_TIPO
				(cAlDetal)->ENTRADAORI	:= (cQuery1)->FT_ENTRADA
				(cAlDetal)->EMISSAOORI	:= (cQuery1)->FT_EMISSAO
				(cAlDetal)->PRODUTOORI	:= (cQuery1)->FT_PRODUTO
				(cAlDetal)->DESCORI			:= (cQuery1)->B1_DESC
				(cAlDetal)->QUANTORI		:= (cQuery1)->FT_QUANT
				(cAlDetal)->PRCUNITORI	:= (cQuery1)->FT_PRCUNIT
				(cAlDetal)->VALCONTORI	:= (cQuery1)->FT_VALCONT
				(cAlDetal)->BASEICMORI	:= (cQuery1)->FT_BASEICM
				(cAlDetal)->ALIQICMORI	:= (cQuery1)->FT_ALIQICM
				(cAlDetal)->VALICMORI		:= (cQuery1)->FT_VALICM
				(cAlDetal)->BASEPISORI	:= (cQuery1)->FT_BASEPIS
				(cAlDetal)->ALIQPISORI	:= (cQuery1)->FT_ALIQPIS
				(cAlDetal)->VALPISORI		:= (cQuery1)->FT_VALPIS
				(cAlDetal)->BASECOFORI	:= (cQuery1)->FT_BASECOF
				(cAlDetal)->ALIQCOFORI	:= (cQuery1)->FT_ALIQCOF
				(cAlDetal)->VALCOFORI		:= (cQuery1)->FT_VALCOF
				(cAlDetal)->TESORI			:= (cQuery1)->FT_TES
				(cAlDetal)->CFOPORI			:= (cQuery1)->FT_CFOP
				(cAlDetal)->CSTPISORI		:= (cQuery1)->FT_CSTPIS
				(cAlDetal)->CSTCOFORI		:= (cQuery1)->FT_CSTCOF
				(cAlDetal)->CODRSEF			:= (cQuery1)->F3_CODRSEF
				(cAlDetal)->DTCANC			:= (cQuery1)->F3_DTCANC
				(cAlDetal)->EMPDESTINO	:= (cQuery1)->EMPRESA_DESTINO
				(cAlDetal)->FILDESTINO	:= (cQuery1)->FILIAL_DESTINO
				(cAlDetal)->CGCDESTINO	:= (cQuery1)->CGC_DESTINO
				(cAlDetal)->CODFORDEST	:= (cQuery1)->CODIGO_FORN_DESTINO
				(cAlDetal)->NOMDESTINO	:= (cQuery1)->NOME_DESTINO

				//Verifica se encontrou NF no destino.
				IF !(cQuery5)->(EOF())
					(cAlDetal)->SERIEDES	:= (cQuery5)->FT_SERIE
					(cAlDetal)->NFISCALDES	:= (cQuery5)->FT_NFISCAL
					(cAlDetal)->ITEMDES		:= (cQuery5)->FT_ITEM
					(cAlDetal)->TIPODES		:= (cQuery5)->FT_TIPO
					(cAlDetal)->ENTRADADES	:= (cQuery5)->FT_ENTRADA
					(cAlDetal)->EMISSAODES	:= (cQuery5)->FT_EMISSAO
					(cAlDetal)->PRODUTODES	:= (cQuery5)->FT_PRODUTO

					//(cAlDetal)->B1_DESC_DESTINO	:= (cQuery5)->B1_DESC

					(cAlDetal)->QUANTDES	:= (cQuery5)->FT_QUANT
					(cAlDetal)->PRCUNITDES	:= (cQuery5)->FT_PRCUNIT
					(cAlDetal)->VALCONTDES	:= (cQuery5)->FT_VALCONT
					(cAlDetal)->BASEICMDES	:= (cQuery5)->FT_BASEICM
					(cAlDetal)->ALIQICMDES	:= (cQuery5)->FT_ALIQICM
					(cAlDetal)->VALICMDES	:= (cQuery5)->FT_VALICM
					(cAlDetal)->BASEPISDES	:= (cQuery5)->FT_BASEPIS
					(cAlDetal)->ALIQPISDES	:= (cQuery5)->FT_ALIQPIS
					(cAlDetal)->VALPISDES	:= (cQuery5)->FT_VALPIS
					(cAlDetal)->BASECOFDES	:= (cQuery5)->FT_BASECOF
					(cAlDetal)->ALIQCOFDES	:= (cQuery5)->FT_ALIQCOF
					(cAlDetal)->VALCOFDES	:= (cQuery5)->FT_VALCOF
					(cAlDetal)->TESDES		:= (cQuery5)->FT_TES
					(cAlDetal)->CFOPDES		:= (cQuery5)->FT_CFOP
					(cAlDetal)->CSTPISDES	:= (cQuery5)->FT_CSTPIS
					(cAlDetal)->CSTCOFDES	:= (cQuery5)->FT_CSTCOF

					(cAlDetal)->CNFVLICMS	:= Round((cQuery1)->FT_VALICM,2) - Round((cQuery5)->FT_VALICM,2)
					(cAlDetal)->CNFVLPIS	:= Round((cQuery1)->FT_VALPIS,2) - Round((cQuery5)->FT_VALPIS,2)
					(cAlDetal)->CNFVLCOF	:= Round((cQuery1)->FT_VALCOF,2) - Round((cQuery5)->FT_VALCOF,2)
				ENDIF
				
			//Verifica se existe NF de Entrada ref a Recusa
				cQuery6 :=  GetNextAlias()
				BeginSql Alias cQuery6
					COLUMN FT_EMISSAO AS DATE
					COLUMN FT_ENTRADA AS DATE
					SELECT 
						SFT.FT_SERIE	AS FT_SERIE,
						SFT.FT_NFISCAL	AS FT_NFISCAL,
						REPLACE(SFT.FT_ITEM,'0','')	AS FT_ITEM,
						SFT.FT_TIPO		AS FT_TIPO,
						SFT.FT_ENTRADA	AS FT_ENTRADA,
						SFT.FT_EMISSAO	AS FT_EMISSAO,
						SFT.FT_PRODUTO	AS FT_PRODUTO,
						SFT.FT_QUANT	AS FT_QUANT,
						SFT.FT_PRCUNIT	AS FT_PRCUNIT,
						SFT.FT_VALCONT	AS FT_VALCONT,
						SFT.FT_BASEICM	AS FT_BASEICM,
						SFT.FT_ALIQICM	AS FT_ALIQICM,
						SFT.FT_VALICM	AS FT_VALICM,
						SFT.FT_OUTRICM	AS FT_OUTRICM,
						SFT.FT_BASEPIS	AS FT_BASEPIS,
						SFT.FT_BASECOF	AS FT_BASECOF,
						SFT.FT_ALIQPIS	AS FT_ALIQPIS,
						SFT.FT_ALIQCOF	AS FT_ALIQCOF,
						SFT.FT_VALPIS	AS FT_VALPIS,
						SFT.FT_VALCOF	AS FT_VALCOF,
						SFT.FT_TES		AS FT_TES,
						SFT.FT_CFOP		AS FT_CFOP,
						SFT.FT_CSTPIS		AS FT_CSTPIS,
						SFT.FT_CSTCOF		AS FT_CSTCOF
					FROM SFT010 SFT (NOLOCK)
						LEFT JOIN SA2010 SA2 (NOLOCK) ON
							SA2.A2_COD = SFT.FT_CLIEFOR
							AND SA2.A2_LOJA = SFT.FT_LOJA
							AND SFT.FT_TIPO IN ('D','B')
							AND SA2.%notDel%
						LEFT JOIN SA1010 SA1 (NOLOCK) ON
							SA1.A1_COD = SFT.FT_CLIEFOR
							AND SA1.A1_LOJA = SFT.FT_LOJA
							AND SFT.FT_TIPO NOT IN ('D','B')
							AND SA1.%notDel%
						LEFT JOIN SB1010 SB1 (NOLOCK) ON
							SB1.B1_COD = SFT.FT_PRODUTO
							AND SB1.%notDel%
						LEFT JOIN SF3010 SF3 (NOLOCK) ON
							SF3.F3_FILIAL = SFT.FT_FILIAL
							AND SF3.F3_SERIE = SFT.FT_SERIE
							AND SF3.F3_NFISCAL = SFT.FT_NFISCAL
							AND SF3.F3_CLIEFOR = SFT.FT_CLIEFOR
							AND SF3.F3_LOJA = SFT.FT_LOJA
							AND SF3.F3_IDENTFT = SFT.FT_IDENTF3
							AND SF3.%notDel%
					WHERE 
							SFT.FT_FILIAL = %Exp:(cQuery1)->FILIAL_ORIGEM%
						AND RTRIM(LTRIM(REPLACE(SFT.FT_SERORI,'0',''))) = RTRIM(LTRIM(REPLACE(%Exp:cSerDest%,'0',''))) //Everson - 30/09/2020. Chamado 25.
						AND SFT.FT_NFORI = %Exp:cNFDest%
						AND RTRIM(LTRIM(REPLACE(SFT.FT_ITEMORI,'0',''))) = RTRIM(LTRIM(%Exp:cItDest%))
						AND SFT.FT_CLIEFOR = %Exp:(cQuery1)->FT_CLIEFOR%
						AND SFT.FT_LOJA = %Exp:(cQuery1)->FT_LOJA%
						AND SFT.FT_CFOP < '5000'
						AND SFT.FT_FORMUL = 'S'
						AND SFT.%notDel%
				EndSql

				lNFRecus := .F.
				IF ALLTRIM((cQuery6)->FT_NFISCAL) <> ''
					lNFRecus := .T.

				ENDIF
				

				//(cAlDetal)->CONF_BASE	:= (cQuery4)->CONF_BASE
				cMsgObs	:= ''
				cCodErr := ''

				IF Alltrim((cAlDetal)->NFISCALDES) == '' .AND. ! (cAlDetal)->CODRSEF $ '101/102' .AND. !lNFRecus
					cMsgObs += 'NF não escriturada no destino'
					cCodErr	:= '000001'

				ELSEIF Alltrim((cAlDetal)->NFISCALDES) <> '' .AND. (cAlDetal)->CODRSEF $ '101/102'
					cMsgObs := 'NF Cancelada e escriturada no destino'
					cCodErr	:= '000002'

				ELSEIF (cAlDetal)->CODRSEF $ '101/102' .AND. lNFRecus
					cMsgObs += 'NF Cancelada / Denegada e Recusa Escriturada na origem'
					cCodErr	:= '000003'

				ELSEIF Alltrim((cAlDetal)->NFISCALDES) <> '' .AND. lNFRecus
					cMsgObs := 'Recusa escriturada na origem e NF também escriturada no destino'
					cCodErr	:= '000004'

				ELSEIF lNFRecus //Everson - 30/09/2020. Chamado 25.

					//
					(cAlDetal)->SERIEDES	:= (cQuery6)->FT_SERIE
					(cAlDetal)->NFISCALDES	:= (cQuery6)->FT_NFISCAL
					(cAlDetal)->ITEMDES		:= (cQuery6)->FT_ITEM
					(cAlDetal)->TIPODES		:= (cQuery6)->FT_TIPO
					(cAlDetal)->ENTRADADES	:= (cQuery6)->FT_ENTRADA
					(cAlDetal)->EMISSAODES	:= (cQuery6)->FT_EMISSAO
					(cAlDetal)->PRODUTODES	:= (cQuery6)->FT_PRODUTO

					(cAlDetal)->QUANTDES	:= (cQuery6)->FT_QUANT
					(cAlDetal)->PRCUNITDES	:= (cQuery6)->FT_PRCUNIT
					(cAlDetal)->VALCONTDES	:= (cQuery6)->FT_VALCONT
					(cAlDetal)->BASEICMDES	:= (cQuery6)->FT_BASEICM
					(cAlDetal)->ALIQICMDES	:= (cQuery6)->FT_ALIQICM
					(cAlDetal)->VALICMDES	:= (cQuery6)->FT_VALICM
					(cAlDetal)->BASEPISDES	:= (cQuery6)->FT_BASEPIS
					(cAlDetal)->ALIQPISDES	:= (cQuery6)->FT_ALIQPIS
					(cAlDetal)->VALPISDES	:= (cQuery6)->FT_VALPIS
					(cAlDetal)->BASECOFDES	:= (cQuery6)->FT_BASECOF
					(cAlDetal)->ALIQCOFDES	:= (cQuery6)->FT_ALIQCOF
					(cAlDetal)->VALCOFDES	:= (cQuery6)->FT_VALCOF
					(cAlDetal)->TESDES		:= (cQuery6)->FT_TES
					(cAlDetal)->CFOPDES		:= (cQuery6)->FT_CFOP
					(cAlDetal)->CSTPISDES	:= (cQuery6)->FT_CSTPIS
					(cAlDetal)->CSTCOFDES	:= (cQuery6)->FT_CSTCOF
					(cAlDetal)->CNFVLICMS	:= Round((cQuery1)->FT_VALICM,2) - Round((cQuery6)->FT_VALICM,2)
					(cAlDetal)->CNFVLPIS	:= Round((cQuery1)->FT_VALPIS,2) - Round((cQuery6)->FT_VALPIS,2)
					(cAlDetal)->CNFVLCOF	:= Round((cQuery1)->FT_VALCOF,2) - Round((cQuery6)->FT_VALCOF,2)

					cMsgObs := 'Recusa com emissão de nota fiscal de entrada'
					cCodErr	:= '000005'

				ELSEIF (cAlDetal)->CNFVLICMS > 0
					cMsgObs := 'Encontrado divergência na escrituração do ICMS, '
					cCodErr	:= '000101'

				ELSEIF (cAlDetal)->CNFVLPIS > 0
					cMsgObs := 'Encontrado divergência na escrituração do PIS, '
					cCodErr	:= '000102'

				ELSEIF (cAlDetal)->CNFVLCOF > 0
					cMsgObs += 'Encontrado divergência na escrituração do COFINS, '
					cCodErr	:= '000103'

				ENDIF

				(cAlDetal)->OBSERVACAO	:= cMsgObs
				(cAlDetal)->CODERRO			:= cCodErr

			MSUNLOCK()

			//Totaliza Resumo
			AddRes( (cAlDetal)->EMPORIGEM+' - '+(cAlDetal)->FILORIGEM + ' ' + Alltrim((cAlDetal)->NOMORIGEM),;
			 				(cAlDetal)->CODERRO + ' ' + (cAlDetal)->OBSERVACAO )

			(cQuery5)->(dbCloseArea())

			(cQuery6)->(dbCloseArea())

		ENDIF
		(cQuery1)->(dbSkip())	
	ENDDO
  (cQuery1)->(dbCloseArea())
	
	MsProcTxt("Processando Dados - Ceres ...")
	//Popula Tabela Temporária - Empresa 02
	(cQuery2)->(dbGoTop())
	WHILE !(cQuery2)->(eof())
		//Apenas se Empresa+Filial de Origem for diferente da Empresa+Filial de Destino
		IF (cQuery2)->EMPRESA_ORIGEM+(cQuery2)->FILIAL_ORIGEM <> (cQuery2)->EMPRESA_DESTINO+(cQuery2)->FILIAL_DESTINO
			//Localiza escrituração no destino
			cQuery5 :=  GetNextAlias()
			cTabQry	:= '%'+'SFT'+(cQuery2)->EMPRESA_DESTINO+'0'+'%'
			cTabQry2:= '%'+'SA1'+(cQuery2)->EMPRESA_DESTINO+'0'+'%'
			cTabQry3:= '%'+'SA2'+(cQuery2)->EMPRESA_DESTINO+'0'+'%'
			cFilDest:= (cQuery2)->FILIAL_DESTINO
			cSerDest:= (cQuery2)->FT_SERIE
			cNFDest	:= (cQuery2)->FT_NFISCAL
			cItDest	:= (cQuery2)->FT_ITEM
			cCdFDest:= (cQuery2)->CGC_ORIGEM
			
			BeginSql Alias cQuery5
				COLUMN FT_EMISSAO AS DATE
				COLUMN FT_ENTRADA AS DATE
				COLUMN F3_DTCANC	AS DATE
				SELECT 
					SFT.FT_SERIE	AS FT_SERIE,
					SFT.FT_NFISCAL	AS FT_NFISCAL,
					REPLACE(SFT.FT_ITEM,'0','')	AS FT_ITEM,
					SFT.FT_TIPO		AS FT_TIPO,
					SFT.FT_ENTRADA	AS FT_ENTRADA,
					SFT.FT_EMISSAO	AS FT_EMISSAO,
					SFT.FT_PRODUTO	AS FT_PRODUTO,
					SFT.FT_QUANT	AS FT_QUANT,
					SFT.FT_PRCUNIT	AS FT_PRCUNIT,
					SFT.FT_VALCONT	AS FT_VALCONT,
					SFT.FT_BASEICM	AS FT_BASEICM,
					SFT.FT_ALIQICM	AS FT_ALIQICM,
					SFT.FT_VALICM	AS FT_VALICM,
					SFT.FT_OUTRICM	AS FT_OUTRICM,
					SFT.FT_BASEPIS	AS FT_BASEPIS,
					SFT.FT_BASECOF	AS FT_BASECOF,
					SFT.FT_ALIQPIS	AS FT_ALIQPIS,
					SFT.FT_ALIQCOF	AS FT_ALIQCOF,
					SFT.FT_VALPIS	AS FT_VALPIS,
					SFT.FT_VALCOF	AS FT_VALCOF,
					SFT.FT_TES		AS FT_TES,
					SFT.FT_CFOP		AS FT_CFOP,
					SFT.FT_CSTPIS		AS FT_CSTPIS,
					SFT.FT_CSTCOF		AS FT_CSTCOF
				FROM %Exp:cTabQry% SFT (NOLOCK)
					LEFT JOIN %Exp:cTabQry2% SA1 (NOLOCK) ON
						SA1.A1_COD = SFT.FT_CLIEFOR
						AND SA1.A1_LOJA = SFT.FT_LOJA
						AND SFT.FT_TIPO IN ('D','B')
						AND SA1.%notDel%
					LEFT JOIN %Exp:cTabQry3% SA2 (NOLOCK) ON
						SA2.A2_COD = SFT.FT_CLIEFOR
						AND SA2.A2_LOJA = SFT.FT_LOJA
						AND SFT.FT_TIPO NOT IN ('D','B')
						AND SA2.%notDel%
				WHERE
					SFT.FT_FILIAL = %Exp:cFilDest%
					AND LTRIM(RTRIM(REPLACE(SFT.FT_SERIE,'0',''))) = LTRIM(RTRIM(REPLACE(%Exp:cSerDest%,'0',''))) //Everson - 30/09/2020. Chamado 25.
					AND SFT.FT_NFISCAL = %Exp:cNFDest%
					AND RTRIM(LTRIM(REPLACE(SFT.FT_ITEM,'0',''))) = RTRIM(LTRIM(%Exp:cItDest%))
					AND SFT.FT_CFOP < '5000'
					AND (SA1.A1_CGC = %Exp:cCdFDest% OR SA2.A2_CGC = %Exp:cCdFDest%)
					AND SFT.%notDel%
			EndSql

			RECLOCK(cAlDetal,.T.)
				(cAlDetal)->EMPORIGEM		:= (cQuery2)->EMPRESA_ORIGEM
				(cAlDetal)->FILORIGEM		:= (cQuery2)->FILIAL_ORIGEM
				(cAlDetal)->CGCORIGEM		:= (cQuery2)->CGC_ORIGEM
				(cAlDetal)->NOMORIGEM		:= xNomOri((cQuery2)->EMPRESA_ORIGEM,(cQuery2)->FILIAL_ORIGEM)
				(cAlDetal)->SERIEORI		:= (cQuery2)->FT_SERIE
				(cAlDetal)->NFISCALORI	:= (cQuery2)->FT_NFISCAL
				(cAlDetal)->ITEMORI			:= (cQuery2)->FT_ITEM
				(cAlDetal)->TIPOORI			:= (cQuery2)->FT_TIPO
				(cAlDetal)->ENTRADAORI	:= (cQuery2)->FT_ENTRADA
				(cAlDetal)->EMISSAOORI	:= (cQuery2)->FT_EMISSAO
				(cAlDetal)->PRODUTOORI	:= (cQuery2)->FT_PRODUTO
				(cAlDetal)->DESCORI			:= (cQuery2)->B1_DESC
				(cAlDetal)->QUANTORI		:= (cQuery2)->FT_QUANT
				(cAlDetal)->PRCUNITORI	:= (cQuery2)->FT_PRCUNIT
				(cAlDetal)->VALCONTORI	:= (cQuery2)->FT_VALCONT
				(cAlDetal)->BASEICMORI	:= (cQuery2)->FT_BASEICM
				(cAlDetal)->ALIQICMORI	:= (cQuery2)->FT_ALIQICM
				(cAlDetal)->VALICMORI		:= (cQuery2)->FT_VALICM
				(cAlDetal)->BASEPISORI	:= (cQuery2)->FT_BASEPIS
				(cAlDetal)->ALIQPISORI	:= (cQuery2)->FT_ALIQPIS
				(cAlDetal)->VALPISORI		:= (cQuery2)->FT_VALPIS
				(cAlDetal)->BASECOFORI	:= (cQuery2)->FT_BASECOF
				(cAlDetal)->ALIQCOFORI	:= (cQuery2)->FT_ALIQCOF
				(cAlDetal)->VALCOFORI		:= (cQuery2)->FT_VALCOF
				(cAlDetal)->TESORI			:= (cQuery2)->FT_TES
				(cAlDetal)->CFOPORI			:= (cQuery2)->FT_CFOP
				(cAlDetal)->CSTPISORI		:= (cQuery2)->FT_CSTPIS
				(cAlDetal)->CSTCOFORI		:= (cQuery2)->FT_CSTCOF
				(cAlDetal)->CODRSEF			:= (cQuery2)->F3_CODRSEF
				(cAlDetal)->DTCANC			:= (cQuery2)->F3_DTCANC
				(cAlDetal)->EMPDESTINO	:= (cQuery2)->EMPRESA_DESTINO
				(cAlDetal)->FILDESTINO	:= (cQuery2)->FILIAL_DESTINO
				(cAlDetal)->CGCDESTINO	:= (cQuery2)->CGC_DESTINO
				(cAlDetal)->CODFORDEST	:= (cQuery2)->CODIGO_FORN_DESTINO
				(cAlDetal)->NOMDESTINO	:= (cQuery2)->NOME_DESTINO

				//Verifica se encontrou NF no destino.
				IF !(cQuery5)->(EOF())
					(cAlDetal)->SERIEDES	:= (cQuery5)->FT_SERIE
					(cAlDetal)->NFISCALDES  := (cQuery5)->FT_NFISCAL
					(cAlDetal)->ITEMDES		:= (cQuery5)->FT_ITEM
					(cAlDetal)->TIPODES		:= (cQuery5)->FT_TIPO
					(cAlDetal)->ENTRADADES:= (cQuery5)->FT_ENTRADA
					(cAlDetal)->EMISSAODES:= (cQuery5)->FT_EMISSAO
					(cAlDetal)->PRODUTODES:= (cQuery5)->FT_PRODUTO

					//(cAlDetal)->DESCDES	:= (cQuery5)->B1_DESC

					(cAlDetal)->QUANTDES	:= (cQuery5)->FT_QUANT
					(cAlDetal)->PRCUNITDES:= (cQuery5)->FT_PRCUNIT
					(cAlDetal)->VALCONTDES:= (cQuery5)->FT_VALCONT
					(cAlDetal)->BASEICMDES:= (cQuery5)->FT_BASEICM
					(cAlDetal)->ALIQICMDES:= (cQuery5)->FT_ALIQICM
					(cAlDetal)->VALICMDES	:= (cQuery5)->FT_VALICM
					(cAlDetal)->BASEPISDES:= (cQuery5)->FT_BASEPIS
					(cAlDetal)->ALIQPISDES:= (cQuery5)->FT_ALIQPIS
					(cAlDetal)->VALPISDES	:= (cQuery5)->FT_VALPIS
					(cAlDetal)->BASECOFDES:= (cQuery5)->FT_BASECOF
					(cAlDetal)->ALIQCOFDES:= (cQuery5)->FT_ALIQCOF
					(cAlDetal)->VALCOFDES	:= (cQuery5)->FT_VALCOF
					(cAlDetal)->TESDES		:= (cQuery5)->FT_TES
					(cAlDetal)->CFOPDES		:= (cQuery5)->FT_CFOP
					(cAlDetal)->CSTPISDES	:= (cQuery5)->FT_CSTPIS
					(cAlDetal)->CSTCOFDES	:= (cQuery5)->FT_CSTCOF

					(cAlDetal)->CNFVLICMS	:= Round((cQuery2)->FT_VALICM,2) - Round((cQuery5)->FT_VALICM,2)
					(cAlDetal)->CNFVLPIS	:= Round((cQuery2)->FT_VALPIS,2) - Round((cQuery5)->FT_VALPIS,2)
					(cAlDetal)->CNFVLCOF	:= Round((cQuery2)->FT_VALCOF,2) - Round((cQuery5)->FT_VALCOF,2)
				ENDIF
				
				//Verifica se existe NF de Entrada ref a Recusa
				cQuery6 :=  GetNextAlias()
				BeginSql Alias cQuery6
					COLUMN FT_EMISSAO AS DATE
					COLUMN FT_ENTRADA AS DATE
					SELECT 
						SFT.FT_SERIE	AS FT_SERIE,
						SFT.FT_NFISCAL	AS FT_NFISCAL,
						REPLACE(SFT.FT_ITEM,'0','')	AS FT_ITEM,
						SFT.FT_TIPO		AS FT_TIPO,
						SFT.FT_ENTRADA	AS FT_ENTRADA,
						SFT.FT_EMISSAO	AS FT_EMISSAO,
						SFT.FT_PRODUTO	AS FT_PRODUTO,
						SFT.FT_QUANT	AS FT_QUANT,
						SFT.FT_PRCUNIT	AS FT_PRCUNIT,
						SFT.FT_VALCONT	AS FT_VALCONT,
						SFT.FT_BASEICM	AS FT_BASEICM,
						SFT.FT_ALIQICM	AS FT_ALIQICM,
						SFT.FT_VALICM	AS FT_VALICM,
						SFT.FT_OUTRICM	AS FT_OUTRICM,
						SFT.FT_BASEPIS	AS FT_BASEPIS,
						SFT.FT_BASECOF	AS FT_BASECOF,
						SFT.FT_ALIQPIS	AS FT_ALIQPIS,
						SFT.FT_ALIQCOF	AS FT_ALIQCOF,
						SFT.FT_VALPIS	AS FT_VALPIS,
						SFT.FT_VALCOF	AS FT_VALCOF,
						SFT.FT_TES		AS FT_TES,
						SFT.FT_CFOP		AS FT_CFOP,
						SFT.FT_CSTPIS		AS FT_CSTPIS,
						SFT.FT_CSTCOF		AS FT_CSTCOF
					FROM SFT020 SFT (NOLOCK)
						LEFT JOIN SA2020 SA2 (NOLOCK) ON
							SA2.A2_COD = SFT.FT_CLIEFOR
							AND SA2.A2_LOJA = SFT.FT_LOJA
							AND SFT.FT_TIPO IN ('D','B')
							AND SA2.%notDel%
						LEFT JOIN SA1020 SA1 (NOLOCK) ON
							SA1.A1_COD = SFT.FT_CLIEFOR
							AND SA1.A1_LOJA = SFT.FT_LOJA
							AND SFT.FT_TIPO NOT IN ('D','B')
							AND SA1.%notDel%
						LEFT JOIN SB1020 SB1 (NOLOCK) ON
							SB1.B1_COD = SFT.FT_PRODUTO
							AND SB1.%notDel%
						LEFT JOIN SF3020 SF3 (NOLOCK) ON
							SF3.F3_FILIAL = SFT.FT_FILIAL
							AND SF3.F3_SERIE = SFT.FT_SERIE
							AND SF3.F3_NFISCAL = SFT.FT_NFISCAL
							AND SF3.F3_CLIEFOR = SFT.FT_CLIEFOR
							AND SF3.F3_LOJA = SFT.FT_LOJA
							AND SF3.F3_IDENTFT = SFT.FT_IDENTF3
							AND SF3.%notDel%
					WHERE 
							SFT.FT_FILIAL = %Exp:(cQuery2)->FILIAL_ORIGEM%
						AND RTRIM(LTRIM(REPLACE(SFT.FT_SERORI,'0',''))) = LTRIM(RTRIM(REPLACE(%Exp:cSerDest%,'0',''))) //Everson - 30/09/2020. Chamado 25.
						AND SFT.FT_NFORI = %Exp:cNFDest%
						AND RTRIM(LTRIM(REPLACE(SFT.FT_ITEMORI,'0',''))) = RTRIM(LTRIM(%Exp:cItDest%))
						AND SFT.FT_CLIEFOR = %Exp:(cQuery2)->FT_CLIEFOR%
						AND SFT.FT_LOJA = %Exp:(cQuery2)->FT_LOJA%
						AND SFT.FT_CFOP < '5000'
						AND SFT.FT_FORMUL = 'S'
						AND SFT.%notDel%
				EndSql

				lNFRecus := .F.
				IF ALLTRIM((cQuery6)->FT_NFISCAL) <> ''
					lNFRecus := .T.

				ENDIF

				//(cAlDetal)->CONF_BASE	:= (cQuery4)->CONF_BASE
				cMsgObs	:= ''
				cCodErr := ''

				IF Alltrim((cAlDetal)->NFISCALDES) == '' .AND. ! (cAlDetal)->CODRSEF $ '101/102' .AND. !lNFRecus
					cMsgObs += 'NF não escriturada no destino'
					cCodErr	:= '000001'

				ELSEIF Alltrim((cAlDetal)->NFISCALDES) <> '' .AND. (cAlDetal)->CODRSEF $ '101/102'
					cMsgObs := 'NF Cancelada e escriturada no destino'
					cCodErr	:= '000002'

				ELSEIF (cAlDetal)->CODRSEF $ '101/102' .AND. lNFRecus
					cMsgObs += 'NF Cancelada / Denegada e Recusa Escriturada na origem'
					cCodErr	:= '000003'

				ELSEIF Alltrim((cAlDetal)->NFISCALDES) <> '' .AND. lNFRecus
					cMsgObs := 'Recusa escriturada na origem e NF também escriturada no destino'
					cCodErr	:= '000004'

				ELSEIF lNFRecus //Everson - 30/09/2020. Chamado 25/09/2020. Chamado 25.

					//
					(cAlDetal)->SERIEDES	:= (cQuery6)->FT_SERIE
					(cAlDetal)->NFISCALDES	:= (cQuery6)->FT_NFISCAL
					(cAlDetal)->ITEMDES		:= (cQuery6)->FT_ITEM
					(cAlDetal)->TIPODES		:= (cQuery6)->FT_TIPO
					(cAlDetal)->ENTRADADES	:= (cQuery6)->FT_ENTRADA
					(cAlDetal)->EMISSAODES	:= (cQuery6)->FT_EMISSAO
					(cAlDetal)->PRODUTODES	:= (cQuery6)->FT_PRODUTO

					(cAlDetal)->QUANTDES	:= (cQuery6)->FT_QUANT
					(cAlDetal)->PRCUNITDES	:= (cQuery6)->FT_PRCUNIT
					(cAlDetal)->VALCONTDES	:= (cQuery6)->FT_VALCONT
					(cAlDetal)->BASEICMDES	:= (cQuery6)->FT_BASEICM
					(cAlDetal)->ALIQICMDES	:= (cQuery6)->FT_ALIQICM
					(cAlDetal)->VALICMDES	:= (cQuery6)->FT_VALICM
					(cAlDetal)->BASEPISDES	:= (cQuery6)->FT_BASEPIS
					(cAlDetal)->ALIQPISDES	:= (cQuery6)->FT_ALIQPIS
					(cAlDetal)->VALPISDES	:= (cQuery6)->FT_VALPIS
					(cAlDetal)->BASECOFDES	:= (cQuery6)->FT_BASECOF
					(cAlDetal)->ALIQCOFDES	:= (cQuery6)->FT_ALIQCOF
					(cAlDetal)->VALCOFDES	:= (cQuery6)->FT_VALCOF
					(cAlDetal)->TESDES		:= (cQuery6)->FT_TES
					(cAlDetal)->CFOPDES		:= (cQuery6)->FT_CFOP
					(cAlDetal)->CSTPISDES	:= (cQuery6)->FT_CSTPIS
					(cAlDetal)->CSTCOFDES	:= (cQuery6)->FT_CSTCOF
					(cAlDetal)->CNFVLICMS	:= Round((cQuery2)->FT_VALICM,2) - Round((cQuery6)->FT_VALICM,2)
					(cAlDetal)->CNFVLPIS	:= Round((cQuery2)->FT_VALPIS,2) - Round((cQuery6)->FT_VALPIS,2)
					(cAlDetal)->CNFVLCOF	:= Round((cQuery2)->FT_VALCOF,2) - Round((cQuery6)->FT_VALCOF,2)

					cMsgObs := 'Recusa com emissão de nota fiscal de entrada'
					cCodErr	:= '000005'

				ELSEIF (cAlDetal)->CNFVLICMS > 0
					cMsgObs := 'Encontrado divergência na escrituração do ICMS, '
					cCodErr	:= '000101'

				ELSEIF (cAlDetal)->CNFVLPIS > 0
					cMsgObs := 'Encontrado divergência na escrituração do PIS, '
					cCodErr	:= '000102'

				ELSEIF (cAlDetal)->CNFVLCOF > 0
					cMsgObs += 'Encontrado divergência na escrituração do COFINS, '
					cCodErr	:= '000103'

				ENDIF

				(cAlDetal)->OBSERVACAO	:= cMsgObs
				(cAlDetal)->CODERRO			:= cCodErr

			MSUNLOCK()

			//Totaliza Resumo
			AddRes( (cAlDetal)->EMPORIGEM+' - '+(cAlDetal)->FILORIGEM + ' ' + Alltrim((cAlDetal)->NOMORIGEM),;
			 				(cAlDetal)->CODERRO + ' ' + (cAlDetal)->OBSERVACAO )

			(cQuery5)->(dbCloseArea())

			(cQuery6)->(dbCloseArea())

		ENDIF
		(cQuery2)->(dbSkip())	
	ENDDO
  (cQuery2)->(dbCloseArea())

	MsProcTxt("Processando Dados - RNX2 ...")
	//Popula Tabela Temporária - Empresa 07
	(cQuery3)->(dbGoTop())
	WHILE !(cQuery3)->(eof())
		//Apenas se Empresa+Filial de Origem for diferente da Empresa+Filial de Destino
		IF (cQuery3)->EMPRESA_ORIGEM+(cQuery3)->FILIAL_ORIGEM <> (cQuery3)->EMPRESA_DESTINO+(cQuery3)->FILIAL_DESTINO
			//Localiza escrituração no destino
			cQuery5 :=  GetNextAlias()
			cTabQry	:= '%'+'SFT'+(cQuery3)->EMPRESA_DESTINO+'0'+'%'
			cTabQry2:= '%'+'SA1'+(cQuery3)->EMPRESA_DESTINO+'0'+'%'
			cTabQry3:= '%'+'SA2'+(cQuery3)->EMPRESA_DESTINO+'0'+'%'
			cFilDest:= (cQuery3)->FILIAL_DESTINO
			cSerDest:= (cQuery3)->FT_SERIE
			cNFDest	:= (cQuery3)->FT_NFISCAL
			cItDest	:= (cQuery3)->FT_ITEM
			cCdFDest:= (cQuery3)->CGC_ORIGEM

			BeginSql Alias cQuery5
				COLUMN FT_EMISSAO AS DATE
				COLUMN FT_ENTRADA AS DATE
				COLUMN F3_DTCANC	AS DATE
				SELECT 
					SFT.FT_SERIE	AS FT_SERIE,
					SFT.FT_NFISCAL	AS FT_NFISCAL,
					REPLACE(SFT.FT_ITEM,'0','')	AS FT_ITEM,
					SFT.FT_TIPO		AS FT_TIPO,
					SFT.FT_ENTRADA	AS FT_ENTRADA,
					SFT.FT_EMISSAO	AS FT_EMISSAO,
					SFT.FT_PRODUTO	AS FT_PRODUTO,
					SFT.FT_QUANT	AS FT_QUANT,
					SFT.FT_PRCUNIT	AS FT_PRCUNIT,
					SFT.FT_VALCONT	AS FT_VALCONT,
					SFT.FT_BASEICM	AS FT_BASEICM,
					SFT.FT_ALIQICM	AS FT_ALIQICM,
					SFT.FT_VALICM	AS FT_VALICM,
					SFT.FT_OUTRICM	AS FT_OUTRICM,
					SFT.FT_BASEPIS	AS FT_BASEPIS,
					SFT.FT_BASECOF	AS FT_BASECOF,
					SFT.FT_ALIQPIS	AS FT_ALIQPIS,
					SFT.FT_ALIQCOF	AS FT_ALIQCOF,
					SFT.FT_VALPIS	AS FT_VALPIS,
					SFT.FT_VALCOF	AS FT_VALCOF,
					SFT.FT_TES		AS FT_TES,
					SFT.FT_CFOP		AS FT_CFOP,
					SFT.FT_CSTPIS		AS FT_CSTPIS,
					SFT.FT_CSTCOF		AS FT_CSTCOF
				FROM %Exp:cTabQry% SFT (NOLOCK)
					LEFT JOIN %Exp:cTabQry2% SA1 (NOLOCK) ON
						SA1.A1_COD = SFT.FT_CLIEFOR
						AND SA1.A1_LOJA = SFT.FT_LOJA
						AND SFT.FT_TIPO IN ('D','B')
						AND SA1.%notDel%
					LEFT JOIN %Exp:cTabQry3% SA2 (NOLOCK) ON
						SA2.A2_COD = SFT.FT_CLIEFOR
						AND SA2.A2_LOJA = SFT.FT_LOJA
						AND SFT.FT_TIPO NOT IN ('D','B')
						AND SA2.%notDel%
				WHERE
					SFT.FT_FILIAL = %Exp:cFilDest%
					AND LTRIM(RTRIM(REPLACE(SFT.FT_SERIE,'0',''))) =LTRIM(RTRIM(REPLACE(%Exp:cSerDest%,'0',''))) //Everson - 30/09/2020. Chamado 25.
					AND SFT.FT_NFISCAL = %Exp:cNFDest%
					AND RTRIM(LTRIM(REPLACE(SFT.FT_ITEM,'0',''))) = RTRIM(LTRIM(%Exp:cItDest%))
					AND SFT.FT_CFOP < '5000'
					AND (SA1.A1_CGC = %Exp:cCdFDest% OR SA2.A2_CGC = %Exp:cCdFDest%)
					AND SFT.%notDel%
			EndSql

			RECLOCK(cAlDetal,.T.)
				(cAlDetal)->EMPORIGEM		:= (cQuery3)->EMPRESA_ORIGEM
				(cAlDetal)->FILORIGEM		:= (cQuery3)->FILIAL_ORIGEM
				(cAlDetal)->CGCORIGEM		:= (cQuery3)->CGC_ORIGEM
				(cAlDetal)->NOMORIGEM		:= xNomOri((cQuery3)->EMPRESA_ORIGEM,(cQuery3)->FILIAL_ORIGEM)
				(cAlDetal)->SERIEORI		:= (cQuery3)->FT_SERIE
				(cAlDetal)->NFISCALORI	:= (cQuery3)->FT_NFISCAL
				(cAlDetal)->ITEMORI			:= (cQuery3)->FT_ITEM
				(cAlDetal)->TIPOORI			:= (cQuery3)->FT_TIPO
				(cAlDetal)->ENTRADAORI	:= (cQuery3)->FT_ENTRADA
				(cAlDetal)->EMISSAOORI	:= (cQuery3)->FT_EMISSAO
				(cAlDetal)->PRODUTOORI	:= (cQuery3)->FT_PRODUTO
				(cAlDetal)->DESCORI			:= (cQuery3)->B1_DESC
				(cAlDetal)->QUANTORI		:= (cQuery3)->FT_QUANT
				(cAlDetal)->PRCUNITORI	:= (cQuery3)->FT_PRCUNIT
				(cAlDetal)->VALCONTORI	:= (cQuery3)->FT_VALCONT
				(cAlDetal)->BASEICMORI	:= (cQuery3)->FT_BASEICM
				(cAlDetal)->ALIQICMORI	:= (cQuery3)->FT_ALIQICM
				(cAlDetal)->VALICMORI		:= (cQuery3)->FT_VALICM
				(cAlDetal)->BASEPISORI	:= (cQuery3)->FT_BASEPIS
				(cAlDetal)->ALIQPISORI	:= (cQuery3)->FT_ALIQPIS
				(cAlDetal)->VALPISORI		:= (cQuery3)->FT_VALPIS
				(cAlDetal)->BASECOFORI	:= (cQuery3)->FT_BASECOF
				(cAlDetal)->ALIQCOFORI	:= (cQuery3)->FT_ALIQCOF
				(cAlDetal)->VALCOFORI		:= (cQuery3)->FT_VALCOF
				(cAlDetal)->TESORI			:= (cQuery3)->FT_TES
				(cAlDetal)->CFOPORI			:= (cQuery3)->FT_CFOP
				(cAlDetal)->CSTPISORI		:= (cQuery3)->FT_CSTPIS
				(cAlDetal)->CSTCOFORI		:= (cQuery3)->FT_CSTCOF
				(cAlDetal)->CODRSEF			:= (cQuery3)->F3_CODRSEF
				(cAlDetal)->DTCANC			:= (cQuery3)->F3_DTCANC
				(cAlDetal)->EMPDESTINO	:= (cQuery3)->EMPRESA_DESTINO
				(cAlDetal)->FILDESTINO	:= (cQuery3)->FILIAL_DESTINO
				(cAlDetal)->CGCDESTINO	:= (cQuery3)->CGC_DESTINO
				(cAlDetal)->CODFORDEST	:= (cQuery3)->CODIGO_FORN_DESTINO
				(cAlDetal)->NOMDESTINO	:= (cQuery3)->NOME_DESTINO

				//Verifica se encontrou NF no destino.
				IF !(cQuery5)->(EOF())
					(cAlDetal)->SERIEDES	:= (cQuery5)->FT_SERIE
					(cAlDetal)->NFISCALDES:= (cQuery5)->FT_NFISCAL
					(cAlDetal)->ITEMDES		:= (cQuery5)->FT_ITEM
					(cAlDetal)->TIPODES		:= (cQuery5)->FT_TIPO
					(cAlDetal)->ENTRADADES:= (cQuery5)->FT_ENTRADA
					(cAlDetal)->EMISSAODES:= (cQuery5)->FT_EMISSAO
					(cAlDetal)->PRODUTODES:= (cQuery5)->FT_PRODUTO

					//(cAlDetal)->DESCDES	:= (cQuery5)->B1_DESC

					(cAlDetal)->QUANTDES	:= (cQuery5)->FT_QUANT
					(cAlDetal)->PRCUNITDES:= (cQuery5)->FT_PRCUNIT
					(cAlDetal)->VALCONTDES:= (cQuery5)->FT_VALCONT
					(cAlDetal)->BASEICMDES:= (cQuery5)->FT_BASEICM
					(cAlDetal)->ALIQICMDES:= (cQuery5)->FT_ALIQICM
					(cAlDetal)->VALICMDES	:= (cQuery5)->FT_VALICM
					(cAlDetal)->BASEPISDES:= (cQuery5)->FT_BASEPIS
					(cAlDetal)->ALIQPISDES:= (cQuery5)->FT_ALIQPIS
					(cAlDetal)->VALPISDES	:= (cQuery5)->FT_VALPIS
					(cAlDetal)->BASECOFDES:= (cQuery5)->FT_BASECOF
					(cAlDetal)->ALIQCOFDES:= (cQuery5)->FT_ALIQCOF
					(cAlDetal)->VALCOFDES	:= (cQuery5)->FT_VALCOF
					(cAlDetal)->TESDES		:= (cQuery5)->FT_TES
					(cAlDetal)->CFOPDES		:= (cQuery5)->FT_CFOP
					(cAlDetal)->CSTPISDES	:= (cQuery5)->FT_CSTPIS
					(cAlDetal)->CSTCOFDES	:= (cQuery5)->FT_CSTCOF

					(cAlDetal)->CNFVLICMS	:= Round((cQuery3)->FT_VALICM,2) - Round((cQuery5)->FT_VALICM,2)
					(cAlDetal)->CNFVLPIS	:= Round((cQuery3)->FT_VALPIS,2) - Round((cQuery5)->FT_VALPIS,2)
					(cAlDetal)->CNFVLCOF	:= Round((cQuery3)->FT_VALCOF,2) - Round((cQuery5)->FT_VALCOF,2)

				ENDIF
				
				//Verifica se existe NF de Entrada ref a Recusa
				cQuery6 :=  GetNextAlias()
				BeginSql Alias cQuery6
					COLUMN FT_EMISSAO AS DATE
					COLUMN FT_ENTRADA AS DATE
					SELECT 
						SFT.FT_SERIE	AS FT_SERIE,
						SFT.FT_NFISCAL	AS FT_NFISCAL,
						REPLACE(SFT.FT_ITEM,'0','')	AS FT_ITEM,
						SFT.FT_TIPO		AS FT_TIPO,
						SFT.FT_ENTRADA	AS FT_ENTRADA,
						SFT.FT_EMISSAO	AS FT_EMISSAO,
						SFT.FT_PRODUTO	AS FT_PRODUTO,
						SFT.FT_QUANT	AS FT_QUANT,
						SFT.FT_PRCUNIT	AS FT_PRCUNIT,
						SFT.FT_VALCONT	AS FT_VALCONT,
						SFT.FT_BASEICM	AS FT_BASEICM,
						SFT.FT_ALIQICM	AS FT_ALIQICM,
						SFT.FT_VALICM	AS FT_VALICM,
						SFT.FT_OUTRICM	AS FT_OUTRICM,
						SFT.FT_BASEPIS	AS FT_BASEPIS,
						SFT.FT_BASECOF	AS FT_BASECOF,
						SFT.FT_ALIQPIS	AS FT_ALIQPIS,
						SFT.FT_ALIQCOF	AS FT_ALIQCOF,
						SFT.FT_VALPIS	AS FT_VALPIS,
						SFT.FT_VALCOF	AS FT_VALCOF,
						SFT.FT_TES		AS FT_TES,
						SFT.FT_CFOP		AS FT_CFOP,
						SFT.FT_CSTPIS		AS FT_CSTPIS,
						SFT.FT_CSTCOF		AS FT_CSTCOF
					FROM SFT070 SFT (NOLOCK)
						LEFT JOIN SA2070 SA2 (NOLOCK) ON
							SA2.A2_COD = SFT.FT_CLIEFOR
							AND SA2.A2_LOJA = SFT.FT_LOJA
							AND SFT.FT_TIPO IN ('D','B')
							AND SA2.%notDel%
						LEFT JOIN SA1070 SA1 (NOLOCK) ON
							SA1.A1_COD = SFT.FT_CLIEFOR
							AND SA1.A1_LOJA = SFT.FT_LOJA
							AND SFT.FT_TIPO NOT IN ('D','B')
							AND SA1.%notDel%
						LEFT JOIN SB1070 SB1 (NOLOCK) ON
							SB1.B1_COD = SFT.FT_PRODUTO
							AND SB1.%notDel%
						LEFT JOIN SF3070 SF3 (NOLOCK) ON
							SF3.F3_FILIAL = SFT.FT_FILIAL
							AND SF3.F3_SERIE = SFT.FT_SERIE
							AND SF3.F3_NFISCAL = SFT.FT_NFISCAL
							AND SF3.F3_CLIEFOR = SFT.FT_CLIEFOR
							AND SF3.F3_LOJA = SFT.FT_LOJA
							AND SF3.F3_IDENTFT = SFT.FT_IDENTF3
							AND SF3.%notDel%
					WHERE 
							SFT.FT_FILIAL = %Exp:(cQuery3)->FILIAL_ORIGEM%
						AND RTRIM(LTRIM(REPLACE(SFT.FT_SERORI,'0',''))) = LTRIM(RTRIM(REPLACE(%Exp:cSerDest%,'0',''))) //Everson - 30/09/2020. Chamado 25.
						AND SFT.FT_NFORI = %Exp:cNFDest%
						AND RTRIM(LTRIM(REPLACE(SFT.FT_ITEMORI,'0',''))) = RTRIM(LTRIM(%Exp:cItDest%))
						AND SFT.FT_CLIEFOR = %Exp:(cQuery3)->FT_CLIEFOR%
						AND SFT.FT_LOJA = %Exp:(cQuery3)->FT_LOJA%
						AND SFT.FT_CFOP < '5000'
						AND SFT.FT_FORMUL = 'S'
						AND SFT.%notDel%
				EndSql

				lNFRecus := .F.
				IF ALLTRIM((cQuery6)->FT_NFISCAL) <> ''
					lNFRecus := .T.

				ENDIF
				

				//(cAlDetal)->CONF_BASE	:= (cQuery4)->CONF_BASE
				cMsgObs	:= ''
				cCodErr := ''

				IF Alltrim((cAlDetal)->NFISCALDES) == '' .AND. ! (cAlDetal)->CODRSEF $ '101/102' .AND. !lNFRecus
					cMsgObs += 'NF não escriturada no destino'
					cCodErr	:= '000001'

				ELSEIF Alltrim((cAlDetal)->NFISCALDES) <> '' .AND. (cAlDetal)->CODRSEF $ '101/102'
					cMsgObs := 'NF Cancelada e escriturada no destino'
					cCodErr	:= '000002'

				ELSEIF (cAlDetal)->CODRSEF $ '101/102' .AND. lNFRecus
					cMsgObs += 'NF Cancelada / Denegada e Recusa Escriturada na origem'
					cCodErr	:= '000003'

				ELSEIF Alltrim((cAlDetal)->NFISCALDES) <> '' .AND. lNFRecus
					cMsgObs := 'Recusa escriturada na origem e NF também escriturada no destino'
					cCodErr	:= '000004'

				ELSEIF lNFRecus //Everson - 30/09/2020. Chamado 25.
					
					//
					(cAlDetal)->SERIEDES	:= (cQuery6)->FT_SERIE
					(cAlDetal)->NFISCALDES	:= (cQuery6)->FT_NFISCAL
					(cAlDetal)->ITEMDES		:= (cQuery6)->FT_ITEM
					(cAlDetal)->TIPODES		:= (cQuery6)->FT_TIPO
					(cAlDetal)->ENTRADADES	:= (cQuery6)->FT_ENTRADA
					(cAlDetal)->EMISSAODES	:= (cQuery6)->FT_EMISSAO
					(cAlDetal)->PRODUTODES	:= (cQuery6)->FT_PRODUTO

					(cAlDetal)->QUANTDES	:= (cQuery6)->FT_QUANT
					(cAlDetal)->PRCUNITDES	:= (cQuery6)->FT_PRCUNIT
					(cAlDetal)->VALCONTDES	:= (cQuery6)->FT_VALCONT
					(cAlDetal)->BASEICMDES	:= (cQuery6)->FT_BASEICM
					(cAlDetal)->ALIQICMDES	:= (cQuery6)->FT_ALIQICM
					(cAlDetal)->VALICMDES	:= (cQuery6)->FT_VALICM
					(cAlDetal)->BASEPISDES	:= (cQuery6)->FT_BASEPIS
					(cAlDetal)->ALIQPISDES	:= (cQuery6)->FT_ALIQPIS
					(cAlDetal)->VALPISDES	:= (cQuery6)->FT_VALPIS
					(cAlDetal)->BASECOFDES	:= (cQuery6)->FT_BASECOF
					(cAlDetal)->ALIQCOFDES	:= (cQuery6)->FT_ALIQCOF
					(cAlDetal)->VALCOFDES	:= (cQuery6)->FT_VALCOF
					(cAlDetal)->TESDES		:= (cQuery6)->FT_TES
					(cAlDetal)->CFOPDES		:= (cQuery6)->FT_CFOP
					(cAlDetal)->CSTPISDES	:= (cQuery6)->FT_CSTPIS
					(cAlDetal)->CSTCOFDES	:= (cQuery6)->FT_CSTCOF
					(cAlDetal)->CNFVLICMS	:= Round((cQuery3)->FT_VALICM,2) - Round((cQuery6)->FT_VALICM,2)
					(cAlDetal)->CNFVLPIS	:= Round((cQuery3)->FT_VALPIS,2) - Round((cQuery6)->FT_VALPIS,2)
					(cAlDetal)->CNFVLCOF	:= Round((cQuery3)->FT_VALCOF,2) - Round((cQuery6)->FT_VALCOF,2)

					cMsgObs := 'Recusa com emissão de nota fiscal de entrada'
					cCodErr	:= '000005'				

				ELSEIF (cAlDetal)->CNFVLICMS > 0
					cMsgObs := 'Encontrado divergência na escrituração do ICMS, '
					cCodErr	:= '000101'

				ELSEIF (cAlDetal)->CNFVLPIS > 0
					cMsgObs := 'Encontrado divergência na escrituração do PIS, '
					cCodErr	:= '000102'

				ELSEIF (cAlDetal)->CNFVLCOF > 0
					cMsgObs += 'Encontrado divergência na escrituração do COFINS, '
					cCodErr	:= '000103'

				ENDIF

				(cAlDetal)->OBSERVACAO	:= cMsgObs
				(cAlDetal)->CODERRO			:= cCodErr

			MSUNLOCK()

			//Totaliza Resumo
			AddRes( (cAlDetal)->EMPORIGEM+' - '+(cAlDetal)->FILORIGEM + ' ' + Alltrim((cAlDetal)->NOMORIGEM),;
			 				(cAlDetal)->CODERRO + ' ' + (cAlDetal)->OBSERVACAO )

			(cQuery5)->(dbCloseArea())

			(cQuery6)->(dbCloseArea())

		ENDIF
		(cQuery3)->(dbSkip())	
	ENDDO
  (cQuery3)->(dbCloseArea())
	/**/
	MsProcTxt("Processando Dados - SAFEGG ...")
	//Popula Tabela Temporária - Empresa 09
	(cQuery4)->(dbGoTop())
	WHILE !(cQuery4)->(eof())
		//Apenas se Empresa+Filial de Origem for diferente da Empresa+Filial de Destino
		IF (cQuery4)->EMPRESA_ORIGEM+(cQuery4)->FILIAL_ORIGEM <> (cQuery4)->EMPRESA_DESTINO+(cQuery4)->FILIAL_DESTINO
			//Localiza escrituração no destino
			cQuery5 :=  GetNextAlias()
			cTabQry	:= '%'+'SFT'+(cQuery4)->EMPRESA_DESTINO+'0'+'%'
			cTabQry2:= '%'+'SA1'+(cQuery4)->EMPRESA_DESTINO+'0'+'%'
			cTabQry3:= '%'+'SA2'+(cQuery4)->EMPRESA_DESTINO+'0'+'%'
			cFilDest:= (cQuery4)->FILIAL_DESTINO
			cSerDest:= (cQuery4)->FT_SERIE
			cNFDest	:= (cQuery4)->FT_NFISCAL
			cItDest	:= (cQuery4)->FT_ITEM
			cCdFDest:= (cQuery4)->CGC_ORIGEM

			BeginSql Alias cQuery5
				COLUMN FT_EMISSAO AS DATE
				COLUMN FT_ENTRADA AS DATE
				SELECT 
					SFT.FT_SERIE	AS FT_SERIE,
					SFT.FT_NFISCAL	AS FT_NFISCAL,
					REPLACE(SFT.FT_ITEM,'0','')	AS FT_ITEM,
					SFT.FT_TIPO		AS FT_TIPO,
					SFT.FT_ENTRADA	AS FT_ENTRADA,
					SFT.FT_EMISSAO	AS FT_EMISSAO,
					SFT.FT_PRODUTO	AS FT_PRODUTO,
					SFT.FT_QUANT	AS FT_QUANT,
					SFT.FT_PRCUNIT	AS FT_PRCUNIT,
					SFT.FT_VALCONT	AS FT_VALCONT,
					SFT.FT_BASEICM	AS FT_BASEICM,
					SFT.FT_ALIQICM	AS FT_ALIQICM,
					SFT.FT_VALICM	AS FT_VALICM,
					SFT.FT_OUTRICM	AS FT_OUTRICM,
					SFT.FT_BASEPIS	AS FT_BASEPIS,
					SFT.FT_BASECOF	AS FT_BASECOF,
					SFT.FT_ALIQPIS	AS FT_ALIQPIS,
					SFT.FT_ALIQCOF	AS FT_ALIQCOF,
					SFT.FT_VALPIS	AS FT_VALPIS,
					SFT.FT_VALCOF	AS FT_VALCOF,
					SFT.FT_TES		AS FT_TES,
					SFT.FT_CFOP		AS FT_CFOP,
					SFT.FT_CSTPIS		AS FT_CSTPIS,
					SFT.FT_CSTCOF		AS FT_CSTCOF
				FROM %Exp:cTabQry% SFT (NOLOCK)
					LEFT JOIN %Exp:cTabQry2% SA1  (NOLOCK) ON
						SA1.A1_COD = SFT.FT_CLIEFOR
						AND SA1.A1_LOJA = SFT.FT_LOJA
						AND SFT.FT_TIPO IN ('D','B')
						AND SA1.%notDel%
					LEFT JOIN %Exp:cTabQry3% SA2  (NOLOCK) ON
						SA2.A2_COD = SFT.FT_CLIEFOR
						AND SA2.A2_LOJA = SFT.FT_LOJA
						AND SFT.FT_TIPO NOT IN ('D','B')
						AND SA2.%notDel%
				WHERE
					SFT.FT_FILIAL = %Exp:cFilDest%
					AND LTRIM(RTRIM(REPLACE(SFT.FT_SERIE,'0',''))) = LTRIM(RTRIM(REPLACE(%Exp:cSerDest%,'0',''))) //Everson - 30/09/2020. Chamado 25.
					AND SFT.FT_NFISCAL = %Exp:cNFDest%
					AND RTRIM(LTRIM(REPLACE(SFT.FT_ITEM,'0',''))) = RTRIM(LTRIM(%Exp:cItDest%))
					AND SFT.FT_CFOP < '5000'
					AND (SA1.A1_CGC = %Exp:cCdFDest% OR SA2.A2_CGC = %Exp:cCdFDest%)
					AND SFT.%notDel%
			EndSql

			RECLOCK(cAlDetal,.T.)
				(cAlDetal)->EMPORIGEM		:= (cQuery4)->EMPRESA_ORIGEM
				(cAlDetal)->FILORIGEM		:= (cQuery4)->FILIAL_ORIGEM
				(cAlDetal)->CGCORIGEM		:= (cQuery4)->CGC_ORIGEM
				(cAlDetal)->NOMORIGEM		:= xNomOri((cQuery4)->EMPRESA_ORIGEM,(cQuery4)->FILIAL_ORIGEM)
				(cAlDetal)->SERIEORI		:= (cQuery4)->FT_SERIE
				(cAlDetal)->NFISCALORI	:= (cQuery4)->FT_NFISCAL
				(cAlDetal)->ITEMORI			:= (cQuery4)->FT_ITEM
				(cAlDetal)->TIPOORI			:= (cQuery4)->FT_TIPO
				(cAlDetal)->ENTRADAORI	:= (cQuery4)->FT_ENTRADA
				(cAlDetal)->EMISSAOORI	:= (cQuery4)->FT_EMISSAO
				(cAlDetal)->PRODUTOORI	:= (cQuery4)->FT_PRODUTO
				(cAlDetal)->DESCORI			:= (cQuery4)->B1_DESC
				(cAlDetal)->QUANTORI		:= (cQuery4)->FT_QUANT
				(cAlDetal)->PRCUNITORI	:= (cQuery4)->FT_PRCUNIT
				(cAlDetal)->VALCONTORI	:= (cQuery4)->FT_VALCONT
				(cAlDetal)->BASEICMORI	:= (cQuery4)->FT_BASEICM
				(cAlDetal)->ALIQICMORI	:= (cQuery4)->FT_ALIQICM
				(cAlDetal)->VALICMORI		:= (cQuery4)->FT_VALICM
				(cAlDetal)->BASEPISORI	:= (cQuery4)->FT_BASEPIS
				(cAlDetal)->ALIQPISORI	:= (cQuery4)->FT_ALIQPIS
				(cAlDetal)->VALPISORI		:= (cQuery4)->FT_VALPIS
				(cAlDetal)->BASECOFORI	:= (cQuery4)->FT_BASECOF
				(cAlDetal)->ALIQCOFORI	:= (cQuery4)->FT_ALIQCOF
				(cAlDetal)->VALCOFORI		:= (cQuery4)->FT_VALCOF
				(cAlDetal)->TESORI			:= (cQuery4)->FT_TES
				(cAlDetal)->CFOPORI			:= (cQuery4)->FT_CFOP
				(cAlDetal)->CSTPISORI		:= (cQuery4)->FT_CSTPIS
				(cAlDetal)->CSTCOFORI		:= (cQuery4)->FT_CSTCOF
				(cAlDetal)->CODRSEF			:= (cQuery4)->F3_CODRSEF
				(cAlDetal)->DTCANC			:= (cQuery4)->F3_DTCANC
				(cAlDetal)->EMPDESTINO	:= (cQuery4)->EMPRESA_DESTINO
				(cAlDetal)->FILDESTINO	:= (cQuery4)->FILIAL_DESTINO
				(cAlDetal)->CGCDESTINO	:= (cQuery4)->CGC_DESTINO
				(cAlDetal)->CODFORDEST	:= (cQuery4)->CODIGO_FORN_DESTINO
				(cAlDetal)->NOMDESTINO	:= (cQuery4)->NOME_DESTINO

				//Verifica se encontrou NF no destino.
				IF !(cQuery5)->(EOF())
					(cAlDetal)->SERIEDES	:= (cQuery5)->FT_SERIE
					(cAlDetal)->NFISCALDES:= (cQuery5)->FT_NFISCAL
					(cAlDetal)->ITEMDES		:= (cQuery5)->FT_ITEM
					(cAlDetal)->TIPODES		:= (cQuery5)->FT_TIPO
					(cAlDetal)->ENTRADADES:= (cQuery5)->FT_ENTRADA
					(cAlDetal)->EMISSAODES:= (cQuery5)->FT_EMISSAO
					(cAlDetal)->PRODUTODES:= (cQuery5)->FT_PRODUTO

					//(cAlDetal)->DESCDES	:= (cQuery5)->B1_DESC

					(cAlDetal)->QUANTDES	:= (cQuery5)->FT_QUANT
					(cAlDetal)->PRCUNITDES:= (cQuery5)->FT_PRCUNIT
					(cAlDetal)->VALCONTDES:= (cQuery5)->FT_VALCONT
					(cAlDetal)->BASEICMDES:= (cQuery5)->FT_BASEICM
					(cAlDetal)->ALIQICMDES:= (cQuery5)->FT_ALIQICM
					(cAlDetal)->VALICMDES	:= (cQuery5)->FT_VALICM
					(cAlDetal)->BASEPISDES:= (cQuery5)->FT_BASEPIS
					(cAlDetal)->ALIQPISDES:= (cQuery5)->FT_ALIQPIS
					(cAlDetal)->VALPISDES	:= (cQuery5)->FT_VALPIS
					(cAlDetal)->BASECOFDES:= (cQuery5)->FT_BASECOF
					(cAlDetal)->ALIQCOFDES:= (cQuery5)->FT_ALIQCOF
					(cAlDetal)->VALCOFDES	:= (cQuery5)->FT_VALCOF
					(cAlDetal)->TESDES		:= (cQuery5)->FT_TES
					(cAlDetal)->CFOPDES		:= (cQuery5)->FT_CFOP
					(cAlDetal)->CSTPISDES	:= (cQuery5)->FT_CSTPIS
					(cAlDetal)->CSTCOFDES	:= (cQuery5)->FT_CSTCOF

					(cAlDetal)->CNFVLICMS	:= Round((cQuery4)->FT_VALICM,2) - Round((cQuery5)->FT_VALICM,2)
					(cAlDetal)->CNFVLPIS	:= Round((cQuery4)->FT_VALPIS,2) - Round((cQuery5)->FT_VALPIS,2)
					(cAlDetal)->CNFVLCOF	:= Round((cQuery4)->FT_VALCOF,2) - Round((cQuery5)->FT_VALCOF,2)

				ENDIF

				//Verifica se existe NF de Entrada ref a Recusa
				cQuery6 :=  GetNextAlias()
				BeginSql Alias cQuery6
					COLUMN FT_EMISSAO AS DATE
					COLUMN FT_ENTRADA AS DATE
					SELECT 
						SFT.FT_SERIE	AS FT_SERIE,
						SFT.FT_NFISCAL	AS FT_NFISCAL,
						REPLACE(SFT.FT_ITEM,'0','')	AS FT_ITEM,
						SFT.FT_TIPO		AS FT_TIPO,
						SFT.FT_ENTRADA	AS FT_ENTRADA,
						SFT.FT_EMISSAO	AS FT_EMISSAO,
						SFT.FT_PRODUTO	AS FT_PRODUTO,
						SFT.FT_QUANT	AS FT_QUANT,
						SFT.FT_PRCUNIT	AS FT_PRCUNIT,
						SFT.FT_VALCONT	AS FT_VALCONT,
						SFT.FT_BASEICM	AS FT_BASEICM,
						SFT.FT_ALIQICM	AS FT_ALIQICM,
						SFT.FT_VALICM	AS FT_VALICM,
						SFT.FT_OUTRICM	AS FT_OUTRICM,
						SFT.FT_BASEPIS	AS FT_BASEPIS,
						SFT.FT_BASECOF	AS FT_BASECOF,
						SFT.FT_ALIQPIS	AS FT_ALIQPIS,
						SFT.FT_ALIQCOF	AS FT_ALIQCOF,
						SFT.FT_VALPIS	AS FT_VALPIS,
						SFT.FT_VALCOF	AS FT_VALCOF,
						SFT.FT_TES		AS FT_TES,
						SFT.FT_CFOP		AS FT_CFOP,
						SFT.FT_CSTPIS		AS FT_CSTPIS,
						SFT.FT_CSTCOF		AS FT_CSTCOF
					FROM SFT090 SFT  (NOLOCK)
						LEFT JOIN SA2090 SA2 (NOLOCK) ON
							SA2.A2_COD = SFT.FT_CLIEFOR
							AND SA2.A2_LOJA = SFT.FT_LOJA
							AND SFT.FT_TIPO IN ('D','B')
							AND SA2.%notDel%
						LEFT JOIN SA1090 SA1 (NOLOCK) ON
							SA1.A1_COD = SFT.FT_CLIEFOR
							AND SA1.A1_LOJA = SFT.FT_LOJA
							AND SFT.FT_TIPO NOT IN ('D','B')
							AND SA1.%notDel%
						LEFT JOIN SB1090 SB1 (NOLOCK) ON
							SB1.B1_COD = SFT.FT_PRODUTO
							AND SB1.%notDel%
						LEFT JOIN SF3090 SF3 (NOLOCK) ON
							SF3.F3_FILIAL = SFT.FT_FILIAL
							AND SF3.F3_SERIE = SFT.FT_SERIE
							AND SF3.F3_NFISCAL = SFT.FT_NFISCAL
							AND SF3.F3_CLIEFOR = SFT.FT_CLIEFOR
							AND SF3.F3_LOJA = SFT.FT_LOJA
							AND SF3.F3_IDENTFT = SFT.FT_IDENTF3
							AND SF3.%notDel%
					WHERE 
							SFT.FT_FILIAL = %Exp:(cQuery4)->FILIAL_ORIGEM%
						AND RTRIM(LTRIM(REPLACE(SFT.FT_SERORI,'0',''))) = LTRIM(RTRIM(REPLACE(%Exp:cSerDest%,'0',''))) //Everson - 30/09/2020. Chamado 25.
						AND SFT.FT_NFORI = %Exp:cNFDest%
						AND RTRIM(LTRIM(REPLACE(SFT.FT_ITEMORI,'0',''))) = RTRIM(LTRIM(%Exp:cItDest%))
						AND SFT.FT_CLIEFOR = %Exp:(cQuery4)->FT_CLIEFOR%
						AND SFT.FT_LOJA = %Exp:(cQuery4)->FT_LOJA%
						AND SFT.FT_CFOP < '5000'
						AND SFT.FT_FORMUL = 'S'
						AND SFT.%notDel%
				EndSql

				lNFRecus := .F.
				IF ALLTRIM((cQuery6)->FT_NFISCAL) <> ''
					lNFRecus := .T.

				ENDIF
				

				//(cAlDetal)->CONF_BASE	:= (cQuery4)->CONF_BASE
				cMsgObs	:= ''
				cCodErr := ''

				IF Alltrim((cAlDetal)->NFISCALDES) == '' .AND. ! (cAlDetal)->CODRSEF $ '101/102' .AND. !lNFRecus
					cMsgObs += 'NF não escriturada no destino'
					cCodErr	:= '000001'

				ELSEIF Alltrim((cAlDetal)->NFISCALDES) <> '' .AND. (cAlDetal)->CODRSEF $ '101/102'
					cMsgObs := 'NF Cancelada e escriturada no destino'
					cCodErr	:= '000002'

				ELSEIF (cAlDetal)->CODRSEF $ '101/102' .AND. lNFRecus
					cMsgObs += 'NF Cancelada / Denegada e Recusa Escriturada na origem'
					cCodErr	:= '000003'

				ELSEIF Alltrim((cAlDetal)->NFISCALDES) <> '' .AND. lNFRecus
					cMsgObs := 'Recusa escriturada na origem e NF também escriturada no destino'
					cCodErr	:= '000004'

				ELSEIF lNFRecus //Everson - 30/09/2020. Chamado 25.
					
					//
					(cAlDetal)->SERIEDES	:= (cQuery6)->FT_SERIE
					(cAlDetal)->NFISCALDES	:= (cQuery6)->FT_NFISCAL
					(cAlDetal)->ITEMDES		:= (cQuery6)->FT_ITEM
					(cAlDetal)->TIPODES		:= (cQuery6)->FT_TIPO
					(cAlDetal)->ENTRADADES	:= (cQuery6)->FT_ENTRADA
					(cAlDetal)->EMISSAODES	:= (cQuery6)->FT_EMISSAO
					(cAlDetal)->PRODUTODES	:= (cQuery6)->FT_PRODUTO

					(cAlDetal)->QUANTDES	:= (cQuery6)->FT_QUANT
					(cAlDetal)->PRCUNITDES	:= (cQuery6)->FT_PRCUNIT
					(cAlDetal)->VALCONTDES	:= (cQuery6)->FT_VALCONT
					(cAlDetal)->BASEICMDES	:= (cQuery6)->FT_BASEICM
					(cAlDetal)->ALIQICMDES	:= (cQuery6)->FT_ALIQICM
					(cAlDetal)->VALICMDES	:= (cQuery6)->FT_VALICM
					(cAlDetal)->BASEPISDES	:= (cQuery6)->FT_BASEPIS
					(cAlDetal)->ALIQPISDES	:= (cQuery6)->FT_ALIQPIS
					(cAlDetal)->VALPISDES	:= (cQuery6)->FT_VALPIS
					(cAlDetal)->BASECOFDES	:= (cQuery6)->FT_BASECOF
					(cAlDetal)->ALIQCOFDES	:= (cQuery6)->FT_ALIQCOF
					(cAlDetal)->VALCOFDES	:= (cQuery6)->FT_VALCOF
					(cAlDetal)->TESDES		:= (cQuery6)->FT_TES
					(cAlDetal)->CFOPDES		:= (cQuery6)->FT_CFOP
					(cAlDetal)->CSTPISDES	:= (cQuery6)->FT_CSTPIS
					(cAlDetal)->CSTCOFDES	:= (cQuery6)->FT_CSTCOF
					(cAlDetal)->CNFVLICMS	:= Round((cQuery4)->FT_VALICM,2) - Round((cQuery6)->FT_VALICM,2)
					(cAlDetal)->CNFVLPIS	:= Round((cQuery4)->FT_VALPIS,2) - Round((cQuery6)->FT_VALPIS,2)
					(cAlDetal)->CNFVLCOF	:= Round((cQuery4)->FT_VALCOF,2) - Round((cQuery6)->FT_VALCOF,2)

					cMsgObs := 'Recusa com emissão de nota fiscal de entrada'
					cCodErr	:= '000005'

				ELSEIF (cAlDetal)->CNFVLICMS > 0
					cMsgObs := 'Encontrado divergência na escrituração do ICMS, '
					cCodErr	:= '000101'

				ELSEIF (cAlDetal)->CNFVLPIS > 0
					cMsgObs := 'Encontrado divergência na escrituração do PIS, '
					cCodErr	:= '000102'

				ELSEIF (cAlDetal)->CNFVLCOF > 0
					cMsgObs += 'Encontrado divergência na escrituração do COFINS, '
					cCodErr	:= '000103'

				ENDIF

				(cAlDetal)->OBSERVACAO	:= cMsgObs
				(cAlDetal)->CODERRO			:= cCodErr

			MSUNLOCK()

			//Totaliza Resumo
			AddRes( (cAlDetal)->EMPORIGEM+' - '+(cAlDetal)->FILORIGEM + ' ' + Alltrim((cAlDetal)->NOMORIGEM),;
			 				(cAlDetal)->CODERRO + ' ' + (cAlDetal)->OBSERVACAO )

			(cQuery5)->(dbCloseArea())

			(cQuery6)->(dbCloseArea())
			
		ENDIF
		(cQuery4)->(dbSkip())	
	ENDDO
  (cQuery4)->(dbCloseArea())

	MsProcTxt("Exportando dados para Excel ...")

	//Planilha1 - Resumo
	CabRes()             
	GExRes()
	
	//Planilha2 - Detalhamento
	CabP2()
	GExP2()

  SalvaXml()
  CriaExcel()
	oAlRes:Delete()
	oAlDet:Delete()
Return

	/*/{Protheus.doc} Static Function CabRes
		Gera Relatório de Conferência de Escrituração Fiscal
		@author Abel Babini Filho
		@since 21/07/2020
		@version 01
		/*/
	Static Function CabRes()
		oExcel:AddworkSheet(cWrksht1)
		oExcel:AddTable(cWrksht1,cPlan01)
		oExcel:AddColumn(cWrksht1,cPlan01,"Origem",1,1)
		oExcel:AddColumn(cWrksht1,cPlan01,"Ocorrência",1,1)
		oExcel:AddColumn(cWrksht1,cPlan01,"Qtd",2,2)
Return


/*/{Protheus.doc} Static Function GExRes
	Gera Relatório Ref. Difal Não Contribuinte
	@author Abel Babini Filho
	@since 09/12/2019
	@version 01
/*/
Static Function GExRes()
	Local _i := 0
	//
	FOR _i := 1 to Len(aResumo)
		oExcel:AddRow(cWrksht1,cPlan01,{aResumo[_i,2],;
																		aResumo[_i,3],;
																		aResumo[_i,4]})
	NEXT _i

	oExcel:AddRow(cWrksht1,cPlan01,{"","",""})
Return

	/*/{Protheus.doc} Static Function CabP2
		Gera Relatório de Conferência de Escrituração Fiscal
		@author Abel Babini Filho
		@since 21/07/2020
		@version 01
		/*/
	Static Function CabP2()
		oExcel:AddworkSheet(cWrksht2)
		oExcel:AddTable(cWrksht2,cPlan02)
		oExcel:AddColumn(cWrksht2,cPlan02,"Empresa Origem",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Filial Origem",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"CNPJ Origem",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Nome Origem",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Série Origem",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Nota Fiscal Origem",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Item Origem",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Tipo Origem",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Dt.Entrada Origem",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Dt.Emissão Origem",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Cod. Produto Origem",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Produto Origem",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Quant. Origem",2,2)
		oExcel:AddColumn(cWrksht2,cPlan02,"Preço Unit. Origem",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Vl. Contábil Origem",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Base ICMS Origem",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Aliq. ICMS Origem",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Vl. ICMS Origem",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Base PIS Origem",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Aliq. PIS Origem",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Vl. PIS Origem",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"CST PIS Origem",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Base COFINS Origem",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Aliq. COFINS Origem",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Vl. COFINS Origem",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"CST COFINS Origem",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"TES Origem",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"CFOP Origem",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Cod. Ret. SEFAZ Origem",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Dt. Cancelamento Origem",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Empresa Destino",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Filial Destino",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"CNPJ Destino",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Nome Destino",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Série Destino",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Nota Fiscal Destino",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Item Destino",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Tipo Destino",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Dt.Entrada Destino",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Dt.Emissão Destino",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Cod. Produto Destino",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Quant. Destino",2,2)
		oExcel:AddColumn(cWrksht2,cPlan02,"Preço Unit. Destino",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Vl. Contábil Destino",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Base ICMS Destino",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Aliq. ICMS Destino",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Vl. ICMS Destino",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Base PIS Destino",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Aliq. PIS Destino",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Vl. PIS Destino",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"CST PIS Destino",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Base COFINS Destino",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Aliq. COFINS Destino",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Vl. COFINS Destino",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"CST COFINS Destino",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"TES Destino",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"CFOP Destino",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Conf. Valor ICMS",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Conf. Valor PIS",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Conf. Valor COFINS",2,3)
		oExcel:AddColumn(cWrksht2,cPlan02,"Cod. Erro",1,1)
		oExcel:AddColumn(cWrksht2,cPlan02,"Msg. Erro",1,1)

	RETURN(NIL)  
	
/*/{Protheus.doc} Static Function GExP2
	Gera Relatório Ref. Difal Não Contribuinte
	@author Abel Babini Filho
	@since 09/12/2019
	@version 01
/*/
Static Function GExP2()
	//
	(cAlDetal)->(dbGoTop())
	While !(cAlDetal)->(Eof())
		oExcel:AddRow(cWrksht2,cPlan02,{(cAlDetal)->EMPORIGEM		,;
																		(cAlDetal)->FILORIGEM			,;
																		(cAlDetal)->CGCORIGEM				,;
																		(cAlDetal)->NOMORIGEM				,;
																		(cAlDetal)->SERIEORI		,;
																		(cAlDetal)->NFISCALORI	,;
																		(cAlDetal)->ITEMORI		,;
																		(cAlDetal)->TIPOORI		,;
																		(cAlDetal)->ENTRADAORI	,;
																		(cAlDetal)->EMISSAOORI	,;
																		(cAlDetal)->PRODUTOORI	,;
																		(cAlDetal)->DESCORI		,;
																		(cAlDetal)->QUANTORI		,;
																		(cAlDetal)->PRCUNITORI	,;
																		(cAlDetal)->VALCONTORI	,;
																		(cAlDetal)->BASEICMORI	,;
																		(cAlDetal)->ALIQICMORI	,;
																		(cAlDetal)->VALICMORI	,;
																		(cAlDetal)->BASEPISORI	,;
																		(cAlDetal)->ALIQPISORI	,;
																		(cAlDetal)->VALPISORI	,;
																		(cAlDetal)->CSTPISORI	,;
																		(cAlDetal)->BASECOFORI	,;
																		(cAlDetal)->ALIQCOFORI	,;
																		(cAlDetal)->VALCOFORI	,;
																		(cAlDetal)->CSTCOFORI	,;
																		(cAlDetal)->TESORI			,;
																		(cAlDetal)->CFOPORI		,;
																		(cAlDetal)->CODRSEF				,;
																		IF(Alltrim(DTOS((cAlDetal)->DTCANC)) == '','',DTOC((cAlDetal)->DTCANC))	,;
																		(cAlDetal)->EMPDESTINO		,;
																		(cAlDetal)->FILDESTINO		,;
																		(cAlDetal)->CGCDESTINO				,;
																		(cAlDetal)->NOMDESTINO			,;
																		(cAlDetal)->SERIEDES	,;
																		(cAlDetal)->NFISCALDES,;
																		(cAlDetal)->ITEMDES		,;
																		(cAlDetal)->TIPODES		,;
																		(cAlDetal)->ENTRADADES,;
																		(cAlDetal)->EMISSAODES,;
																		(cAlDetal)->PRODUTODES,;
																		(cAlDetal)->QUANTDES	,;
																		(cAlDetal)->PRCUNITDES,;
																		(cAlDetal)->VALCONTDES,;
																		(cAlDetal)->BASEICMDES,;
																		(cAlDetal)->ALIQICMDES,;
																		(cAlDetal)->VALICMDES	,;
																		(cAlDetal)->BASEPISDES,;
																		(cAlDetal)->ALIQPISDES,;
																		(cAlDetal)->VALPISDES	,;
																		(cAlDetal)->CSTPISDES	,;
																		(cAlDetal)->BASECOFDES,;
																		(cAlDetal)->ALIQCOFDES,;
																		(cAlDetal)->VALCOFDES	,;
																		(cAlDetal)->CSTCOFDES	,;
																		(cAlDetal)->TESDES		,;
																		(cAlDetal)->CFOPDES		,;
																		(cAlDetal)->CNFVLICMS	,;
																		(cAlDetal)->CNFVLPIS	,;
																		(cAlDetal)->CNFVLCOF	,;
																		(cAlDetal)->CODERRO			,;
																		(cAlDetal)->OBSERVACAO})
//																		(cAlDetal)->CODFORDEST,;

		(cAlDetal)->(dbSkip())
	ENDDO
	(cAlDetal)->(dbGoTop())
	oExcel:AddRow(cWrksht2,cPlan02,{"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""})
Return



/*/{Protheus.doc} Static Function SalvaXml  
	Salva Arquivo XML - Excel
	@author Abel Babini Filho
	@since 01/06/2020
	@version 01
	/*/
Static Function SalvaXml()
	oExcel:Activate()
	oExcel:GetXMLFile(cArquivo)
Return()

/*/{Protheus.doc} Static Function CriaExcel  
	Cria Arquivo XML - Excel
	@author Abel Babini Filho
	@since 01/06/2020
	@version 01
	/*/
Static Function CriaExcel()
  oMsExcel := MsExcel():New()
	oMsExcel:WorkBooks:Open(cArquivo)
	oMsExcel:SetVisible( .T. )
	oMsExcel:Destroy()
Return() 

/*/{Protheus.doc} Static Function CriaExtr
	Cria Array com a extrutura para criação da Tabela Temporária no Banco de Dados.
	@type  Static Function
	@author Abel Babini Filho
	@since 09/06/2020
	@version 1
	/*/
Static Function CriaExtr(_table)
	Local _aFields := {}
	// Local aSFil := {}
		aSNF		:= FWTamSX3("FT_NFISCAL")
		aSNFSer := FWTamSX3("FT_SERIE")
		aSNFIte := FWTamSX3("FT_ITEM")
		aSTipo 	:= FWTamSX3("FT_TIPO")
		aSDtEnt := FWTamSX3("FT_ENTRADA")
		aSDtEmi := FWTamSX3("FT_EMISSAO")
		aSCliFo := FWTamSX3("FT_CLIEFOR")
		aSLoja	:= FWTamSX3("FT_LOJA")
		aSNome	:= FWTamSX3("A1_NOME")
		aSEsta	:= FWTamSX3("FT_ESTADO")
		aSCNPJ	:= FWTamSX3("A1_CGC")		
		aSCfo 	:= FWTamSX3("FT_CFOP")
		aSTes 	:= FWTamSX3("FT_TES")
		aSPrd 	:= FWTamSX3("FT_PRODUTO")
		aSDPr		:= FWTamSX3("B1_DESC")
		aSQtd 	:= FWTamSX3("FT_QUANT")
		aSPrUnit:= FWTamSX3("FT_PRCUNIT")
		aSVCt 	:= FWTamSX3("FT_VALCONT")
		aSVlICM := FWTamSX3("FT_VALICM")
		aSBsICM := FWTamSX3("FT_BASEICM")
		aSAlICM := FWTamSX3("FT_ALIQICM")
		aSBsPis := FWTamSX3("FT_BASEPIS")
		aSBsCof := FWTamSX3("FT_BASECOF")
    aSVPis 	:= FWTamSX3("FT_VALPIS")
		aSVCof 	:= FWTamSX3("FT_VALCOF")
		aSAlPis := FWTamSX3("FT_ALIQPIS")
		aSAlCof := FWTamSX3("FT_ALIQCOF")
		aSCdRSEF:= FWTamSX3("F3_CODRSEF")
		aSDtCanc:= FWTamSX3("F3_DTCANC")
		aSCSPis := FWTamSX3("FT_CSTPIS")
		aSCSCof := FWTamSX3("FT_CSTCOF")

	IF _table == 'RESUMO'
		aadd(_aFields,{"LINHA","N",6,0})
		aadd(_aFields,{"TPLIN","C",3,0})
		aadd(_aFields,{"EMPORIGEM","C",02,0})
		aadd(_aFields,{"FILORIGEM","C",02,0})
		aadd(_aFields,{"NOMORIGEM",aSNome[3],aSNome[1],aSNome[2]})
		aadd(_aFields,{"EMPDESTINO","C",02,0})
		aadd(_aFields,{"FILDESTINO","C",02,0})
		aadd(_aFields,{"NOMDESTINO",aSNome[3],aSNome[1],aSNome[2]})
		aadd(_aFields,{"VLDCODRSEF","C",40,0})
		aadd(_aFields,{"VLDICMS","C",40,0})
		aadd(_aFields,{"VLDPIS","C",40,0})
		aadd(_aFields,{"VLDCOF","C",40,0})
		aadd(_aFields,{"CODERRO","C",6,0})
		aadd(_aFields,{"OBSERVACAO","C",40,0})

	ELSEIF _table == 'DETALHE'
    aadd(_aFields,{"EMPORIGEM","C",02,0})
    aadd(_aFields,{"FILORIGEM","C",02,0})
		aadd(_aFields,{"CGCORIGEM","C",14,0})
		aadd(_aFields,{"NOMORIGEM",aSNome[3],aSNome[1],aSNome[2]})
		aadd(_aFields,{"SERIEORI",aSNFSer[3],aSNFSer[1],aSNFSer[2]})
		aadd(_aFields,{"NFISCALORI",aSNF[3],aSNF[1],aSNF[2]})
		aadd(_aFields,{"ITEMORI",aSNFIte[3],aSNFIte[1],aSNFIte[2]})
		aadd(_aFields,{"TIPOORI",aSTipo[3],aSTipo[1],aSTipo[2]})
		aadd(_aFields,{"ENTRADAORI",aSDtEnt[3],aSDtEnt[1],aSDtEnt[2]})
		aadd(_aFields,{"EMISSAOORI",aSDtEmi[3],aSDtEmi[1],aSDtEmi[2]})
		aadd(_aFields,{"PRODUTOORI",aSPrd[3],aSPrd[1],aSPrd[2]})
		aadd(_aFields,{"DESCORI",aSDPr[3],aSDPr[1],aSDPr[2]})
		aadd(_aFields,{"QUANTORI",aSQtd[3],aSQtd[1],aSQtd[2]})
		aadd(_aFields,{"PRCUNITORI",aSPrUnit[3],aSPrUnit[1],aSPrUnit[2]})
		aadd(_aFields,{"VALCONTORI",aSVCt[3],aSVCt[1],aSVCt[2]})
		aadd(_aFields,{"BASEICMORI",aSBsICM[3],aSBsICM[1],aSBsICM[2]})
		aadd(_aFields,{"ALIQICMORI",aSAlICM[3],aSAlICM[1],aSAlICM[2]})
		aadd(_aFields,{"VALICMORI",aSVlICM[3],aSVlICM[1],aSVlICM[2]})
		aadd(_aFields,{"BASEPISORI",aSBsPis[3],aSBsPis[1],aSBsPis[2]})
		aadd(_aFields,{"ALIQPISORI",aSAlPis[3],aSAlPis[1],aSAlPis[2]})
		aadd(_aFields,{"VALPISORI",aSVPis[3],aSVPis[1],aSVPis[2]})
		aadd(_aFields,{"BASECOFORI",aSBsCof[3],aSBsCof[1],aSBsCof[2]})
		aadd(_aFields,{"ALIQCOFORI",aSAlCof[3],aSAlCof[1],aSAlCof[2]})
		aadd(_aFields,{"VALCOFORI",aSVCof[3],aSVCof[1],aSVCof[2]})
		aadd(_aFields,{"TESORI",aSTes[3],aSTes[1],aSTes[2]})
		aadd(_aFields,{"CFOPORI",aSCfo[3],aSCfo[1],aSCfo[2]})
		aadd(_aFields,{"CSTPISORI",aSCSPis[3],aSCSPis[1],aSCSPis[2]})
		aadd(_aFields,{"CSTCOFORI",aSCSCof[3],aSCSCof[1],aSCSCof[2]})
		aadd(_aFields,{"CODRSEF",aSCdRSEF[3],aSCdRSEF[1],aSCdRSEF[2]})
		aadd(_aFields,{"DTCANC",aSDtCanc[3],aSDtCanc[1],aSDtCanc[2]})

		aadd(_aFields,{"EMPDESTINO","C",02,0})
		aadd(_aFields,{"FILDESTINO","C",02,0})
		aadd(_aFields,{"CGCDESTINO","C",14,0})
		aadd(_aFields,{"CODFORDEST","C",8,0})
		aadd(_aFields,{"NOMDESTINO",aSNome[3],aSNome[1],aSNome[2]})
		aadd(_aFields,{"SERIEDES",aSNFSer[3],aSNFSer[1],aSNFSer[2]})
		aadd(_aFields,{"NFISCALDES",aSNF[3],aSNF[1],aSNF[2]})
		aadd(_aFields,{"ITEMDES",aSNFIte[3],aSNFIte[1],aSNFIte[2]})
		aadd(_aFields,{"TIPODES",aSTipo[3],aSTipo[1],aSTipo[2]})
		aadd(_aFields,{"ENTRADADES",aSDtEnt[3],aSDtEnt[1],aSDtEnt[2]})
		aadd(_aFields,{"EMISSAODES",aSDtEmi[3],aSDtEmi[1],aSDtEmi[2]})
		aadd(_aFields,{"PRODUTODES",aSPrd[3],aSPrd[1],aSPrd[2]})
		aadd(_aFields,{"DESCDES",aSDPr[3],aSDPr[1],aSDPr[2]})
		aadd(_aFields,{"QUANTDES",aSQtd[3],aSQtd[1],aSQtd[2]})
		aadd(_aFields,{"PRCUNITDES",aSPrUnit[3],aSPrUnit[1],aSPrUnit[2]})
		aadd(_aFields,{"VALCONTDES",aSVCt[3],aSVCt[1],aSVCt[2]})
		aadd(_aFields,{"BASEICMDES",aSBsICM[3],aSBsICM[1],aSBsICM[2]})
		aadd(_aFields,{"ALIQICMDES",aSAlICM[3],aSAlICM[1],aSAlICM[2]})
		aadd(_aFields,{"VALICMDES",aSVlICM[3],aSVlICM[1],aSVlICM[2]})
		aadd(_aFields,{"BASEPISDES",aSBsPis[3],aSBsPis[1],aSBsPis[2]})
		aadd(_aFields,{"ALIQPISDES",aSAlPis[3],aSAlPis[1],aSAlPis[2]})
		aadd(_aFields,{"VALPISDES",aSVPis[3],aSVPis[1],aSVPis[2]})
		aadd(_aFields,{"BASECOFDES",aSBsCof[3],aSBsCof[1],aSBsCof[2]})
		aadd(_aFields,{"ALIQCOFDES",aSAlCof[3],aSAlCof[1],aSAlCof[2]})
		aadd(_aFields,{"VALCOFDES",aSVCof[3],aSVCof[1],aSVCof[2]})
		aadd(_aFields,{"TESDES",aSTes[3],aSTes[1],aSTes[2]})
		aadd(_aFields,{"CFOPDES",aSCfo[3],aSCfo[1],aSCfo[2]})
		aadd(_aFields,{"CSTPISDES",aSCSPis[3],aSCSPis[1],aSCSPis[2]})
		aadd(_aFields,{"CSTCOFDES",aSCSCof[3],aSCSCof[1],aSCSCof[2]})

		aadd(_aFields,{"CNFVLICMS",aSBsICM[3],aSBsICM[1],aSBsICM[2]})
		aadd(_aFields,{"CNFVLPIS",aSBsICM[3],aSBsICM[1],aSBsICM[2]})
		aadd(_aFields,{"CNFVLCOF",aSBsICM[3],aSBsICM[1],aSBsICM[2]})

		aadd(_aFields,{"CONFBASE",aSBsICM[3],aSBsICM[1],aSBsICM[2]})
		
		aadd(_aFields,{"CODERRO","C",6,0})
		aadd(_aFields,{"OBSERVACAO","C",200,0})
	ENDIF

Return _aFields

/*/{Protheus.doc} Static Function CriaInd
	Cria Array com a extrutura para criação da Tabela Temporária no Banco de Dados.
	@type  Static Function
	@author Abel Babini Filho
	@since 09/06/2020
	@version 1
	/*/
Static Function CriaInd(_table)
		Local _aIndex := {}

	IF _table == 'RESUMO'
		AADD(_aIndex,{'01',{'LINHA'}})
	ELSEIF _table == 'DETALHE'
		AADD(_aIndex,{'01',{'EMPORIGEM','FILORIGEM','SERIEORI','NFISCALORI','ITEMORI'}})
	ENDIF
Return _aIndex

/*/{Protheus.doc} Static Function CriaTmpT
	Cria Tabela Temporária no Banco de Dados.
	@type  Static Function
	@author Abel Babini Filho
	@since 09/06/2020
	@version 1
	/*/
Static Function CriaTmpT(_oTable, _aFields, _aIndex)
	Local oTempTable
	Local i
	oTempTable := FWTemporaryTable():New(_oTable)

	oTemptable:SetFields( _aFields )
	For i:=1 to Len(_aIndex)
		oTempTable:AddIndex(_aIndex[i,1], _aIndex[i,2] )
		//oTempTable:AddIndex("indice2", {"CONTR", "ALIAS"} )
	Next i
	oTempTable:Create()

Return oTempTable

/*/{Protheus.doc} Static Function xNomOri
	Retorna Nome da Filial de Origem
	@type  Static Function
	@author Abel Babini Filho
	@since 24/07/2020
	@version 1
	/*/
Static Function xNomOri(_xEmp, _xFil)
	Local cRet	:= ''
	Local aSM0Data1 := FWSM0Util():GetSM0Data( _xEmp , _xFil , { "M0_NOME", "M0_FILIAL" } ) //Retorna o M0_CODFIL do grupo 99 e filial 01
	cRet := Alltrim(aSM0Data1[1,2]) + " - " + Alltrim(aSM0Data1[2,2])
Return cRet

/*/{Protheus.doc} Static Function AddRes
	Cria Array Totalizador
	@type  Static Function
	@author Abel Babini Filho
	@since 27/07/2020
	@version 1
	/*/
Static Function AddRes(cOrigem, cErro)
	nPos := ASCAN(aResumo, {|X| X[1] == cOrigem+cErro})
			
	If nPos == 0
		AADD(aResumo,{cOrigem+cErro,cOrigem,cErro,1})
		ASORT(aResumo, , ,  { | x,y | y[1] > x[1] } )
	Else
		aResumo[nPos,4] += 1
	Endif
	
Return
